"use strict";(self.webpackChunkfl=self.webpackChunkfl||[]).push([[127],{6688:(e,t,s)=>{s.r(t),s.d(t,{default:()=>Se});var l=s(9896),a=s(9419),n=s(2023),o=s(7980),i=s(6233),r=(s(6433),s(5043)),d=s(241),c=s(4812);const u=new class{constructor(){this.modalStack=[],(0,c.l_)(this,{modalStack:c.sH.shallow},{autoBind:!0})}get isOpen(){return this.modalStack.length>0}open(e){this.modalStack.push(e)}close(){this.modalStack.pop()}clear(){this.modalStack=[]}};var m=s(3910),x=s(7929),h=s(5786),g=s(6727),f=s(5526);function p(e){return e?{Authorization:`Bearer ${e}`}:void 0}const b={getUser:async function(e,t){return f.A.get("/api/services/app/User/Get",{params:{Id:e},headers:p(t)})},getAllUsers:async function(e){return f.A.get("/api/services/app/User/GetAll",{headers:p(e)})},createNewUser:async function(e,t){return f.A.post("/api/services/app/User/Create",e,{headers:p(t)})},editUser:async function(e,t){return f.A.put("/api/services/app/User/Update",e,{headers:p(t)})},deleteUser:async function(e,t){return f.A.delete("/api/services/app/User/Delete",{params:{Id:e},headers:p(t)})},active:async function(e,t){return f.A.post("/api/services/app/User/Activate",{id:e},{headers:p(t)})},deactivate:async function(e,t){return f.A.post("/api/services/app/User/DeActivate",{id:e},{headers:p(t)})},resetPassword:async function(e,t){return f.A.post("/api/services/app/User/ResetPassword",e,{headers:p(t)})},changePassword:async function(e,t){return f.A.post("/api/services/app/User/ChangePassword",e,{headers:p(t)})}};const v=new class{constructor(){this.error=null,this.doneMsg=null,this.userData=null,this.userRoles=null,this.allUsers=null,(0,c.l_)(this)}async getUser(e,t){try{const s=await b.getUser(e,t);this.userData=s.data.result,this.userRoles=this.userData.roleNames}catch(a){var s,l;this.error=null===(s=a.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message,console.log(this.error)}}async getAllUsers(e){try{const t=await b.getAllUsers(e);this.allUsers=t.data.result.items}catch(t){console.log(t)}}async createNewUser(e,t){this.loading=!0;try{await b.createNewUser(e,t),this.doneMsg="Created!",this.loading=!1}catch(s){this.error=s.response.data.error.message,this.loading=!1}}async editUser(e,t){try{await b.editUser(e,t),this.doneMsg="Change successfully"}catch(s){console.log(s)}}async deleteUser(e,t){try{await b.deleteUser(e,t)}catch(s){console.log(s)}}async active(e,t){try{await b.active(e,t)}catch(a){var s,l;this.error=null===(s=a.response)||void 0===s||null===(l=s.data)||void 0===l?void 0:l.message,console.log(a)}}async deactivate(e,t){try{await b.deactivate(e,t)}catch(s){console.log(s)}}async resetPassword(e,t){this.loading=!0;try{await b.resetPassword(e,t),this.doneMsg="Reset completed successfully",this.loading=!1}catch(s){console.log(s),this.loading=!1}}async changePassword(e,t){this.loading=!0;try{await b.changePassword(e,t),this.doneMsg="Change Password successfully",this.loading=!1}catch(s){this.error=s.response.data.error.message,this.loading=!1}}};var y=s(4117),j=s(579);const w=(0,i.PA)((e=>{let{close:t}=e;const{t:s}=(0,y.Bd)(),[l,a]=(0,r.useState)({currentPassword:"",newPassword:""});return(0,j.jsxs)(h.aF,{show:!0,onClose:()=>{t(),v.doneMsg=null,v.error=null},size:"sm",popup:!0,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:s("ChangePassword.header")}),(0,j.jsx)(h.aF.Body,{children:(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${v.error?"":"hidden"}  text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",v.error]}),(0,j.jsx)("div",{className:`font-bold ${v.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:v.doneMsg&&v.doneMsg})]}),(0,j.jsxs)("form",{onSubmit:e=>async function(e){e.preventDefault(),v.doneMsg=null,v.error=null,await v.changePassword(l,d.A.token),v.doneMsg?v.error=null:v.doneMsg=null}(e),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm/6 font-medium ",children:s("ChangePassword.currentPassword")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"currentPassword",name:"currentPassword",type:"text",required:!0,autoComplete:"currentPassword",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>a((t=>({...t,currentPassword:e.target.value})))})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"newPassword",className:"block text-sm/6 font-medium ",children:s("ChangePassword.newPassword")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"newPassword",name:"newPassword",type:"text",required:!0,autoComplete:"newPassword",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>a((t=>({...t,newPassword:e.target.value})))})})]}),(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:v.loading?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):"Change"})]})]})})]})})),N=(0,i.PA)((e=>{let{close:t}=e;const{t:s}=(0,y.Bd)();return(0,r.useEffect)((()=>{v.loading=!0,async function(){v.loading=!0,await v.getUser(d.A.userId,d.A.token)}(),v.loading=!1}),[]),(0,j.jsx)("div",{children:v.userData?(0,j.jsxs)(h.aF,{show:!0,onClose:()=>{t(),v.doneMsg=null,v.error=null},size:"md",popup:!0,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:s("ProfileInformation.header")}),d.A.userId&&(0,j.jsx)(h.aF.Body,{children:(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${v.error?"":"hidden"}  text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",v.error]}),(0,j.jsx)("div",{className:`font-bold ${v.doneMsg?"":"hidden"} text-green-600 mt-3  text-center`,children:v.doneMsg&&v.doneMsg})]}),(0,j.jsxs)("form",{onSubmit:e=>async function(e){e.preventDefault(),v.loading=!0,v.doneMsg=null,v.error=null;const t=e.target,s={name:t.name.value,id:t.id.value,emailAddress:t.emailAddress.value,userName:t.userName.value};v.userData={...v.userData,...s},await v.editUser(v.userData,d.A.token),v.loading=!1,v.doneMsg?v.error=null:v.doneMsg=null}(e),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"user-name",className:"block text-sm/6 font-medium ",children:s("ProfileInformation.userName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"user-name",name:"userName",type:"text",required:!0,autoComplete:"user-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:v.userData.userName})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"name",className:"block text-sm/6 font-medium ",children:s("ProfileInformation.name")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"name",name:"name",type:"text",required:!0,autoComplete:"name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:v.userData.name})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"id",className:"block text-sm/6 font-medium ",children:s("ProfileInformation.id")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"id",name:"id",type:"text",required:!0,autoComplete:"id",className:"block w-full text-black rounded-md bg-slate-400 px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6 hover:cursor-not-allowed",defaultValue:v.userData.id,disabled:!0})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"emailAddress",className:"block text-sm/6 font-medium ",children:s("ProfileInformation.email")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"emailAddress",name:"emailAddress",type:"emailAddress",required:!0,autoComplete:"emailAddress",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:v.userData.emailAddress})})]}),v.loading?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:s("ProfileInformation.change")})]})]})})]}):(0,j.jsx)("div",{children:"Loading..."})})}));var S=s(3583);const k=(0,i.PA)((e=>{let{close:t}=e;const{t:s}=(0,y.Bd)(),[l,a]=(0,r.useState)(!1),[n,o]=(0,r.useState)(!1),[i,c]=(0,r.useState)({adminPassword:"",newPassword:"",userId:null});return(0,r.useEffect)((()=>{v.error=null}),[]),(0,j.jsx)(S.A,{permission:["Users.ResetPassword"],children:(0,j.jsxs)(h.aF,{show:!0,onClose:()=>{t(),v.doneMsg=null,v.error=null},size:"sm",popup:!0,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:s("ResetPassword.header")}),(0,j.jsx)(h.aF.Body,{children:(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${v.error?"":"hidden"}  text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",v.error]}),(0,j.jsx)("div",{className:`font-bold ${v.doneMsg?"":"hidden"}  text-center text-green-600 mt-3`,children:v.doneMsg&&v.doneMsg})]}),(0,j.jsxs)("form",{onSubmit:e=>async function(e){e.preventDefault(),v.doneMsg=null,v.error=null,await v.resetPassword(i,d.A.token),v.doneMsg?v.error=null:v.doneMsg=null}(e),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"adminPassword",className:"block text-sm/6 font-medium ",children:s("ResetPassword.adminPassword")}),(0,j.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,j.jsx)("input",{id:"adminPassword",name:"adminPassword",type:l?"text":"password",required:!0,autoComplete:"adminPassword",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>c((t=>({...t,adminPassword:e.target.value})))}),(0,j.jsx)("span",{className:"hover:cursor-pointer ms-1",onClick:()=>{a(!l)},children:(0,j.jsx)(m.g,{icon:l?x.pS3:x.k6j})})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"newPassword",className:"block text-sm/6 font-medium ",children:s("ResetPassword.newPassword")}),(0,j.jsxs)("div",{className:"mt-2 flex items-center ",children:[(0,j.jsx)("input",{id:"newPassword",name:"newPassword",type:n?"text":"password",required:!0,autoComplete:"newPassword",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>c((t=>({...t,newPassword:e.target.value})))}),(0,j.jsx)("span",{className:"hover:cursor-pointer ms-1",onClick:()=>{o(!n)},children:(0,j.jsx)(m.g,{icon:n?x.pS3:x.k6j})})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"userId",className:"block text-sm/6 font-medium ",children:s("ResetPassword.id")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"userId",name:"userId",type:"text",required:!0,autoComplete:"userId",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base  outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>c((t=>({...t,userId:+e.target.value})))})})]}),(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:v.loading?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):`${s("ResetPassword.change")}`})]})]})})]})})}));var A=s(5051),C=s(184);const I=(0,i.PA)((e=>{let{action:t,close:s,id:l}=e;return(0,j.jsxs)(h.aF,{size:"md",show:!0,onClose:s,className:"nav",popup:!0,children:[(0,j.jsx)(h.aF.Header,{}),(0,j.jsxs)(h.aF.Body,{className:"flex flex-col items-center justify-center py-6",children:[(0,j.jsx)(m.g,{icon:x.SGM,className:"w-16 h-16 text-green-500 mb-4"}),(0,j.jsxs)("div",{className:"text-xl font-semibold text-center mb-2",children:["Action ",(0,j.jsx)("span",{className:"inline-block bg-red-100 text-red-800 px-2 py-1 rounded",children:t})," completed successfully!"]}),(0,j.jsxs)("div",{className:"text-gray-500 text-sm mb-4",children:["Reference ID: ",(0,j.jsx)("span",{className:"font-mono",children:l})]}),(0,j.jsx)(h.$n,{onClick:async()=>{u.clear()},className:"w-32 bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-300 transition",children:"OK"})]})]})})),L=(0,i.PA)((e=>{let{action:t,actionFunc:s,close:l,id:a,token:n,afterActionFunc:o,type:i}=e;const{t:r}=(0,y.Bd)();return(0,j.jsxs)(h.aF,{size:"md",show:!0,onClose:l,className:"nav",popup:!0,children:[(0,j.jsx)(h.aF.Header,{}),(0,j.jsxs)(h.aF.Body,{className:"flex flex-col items-center justify-center",children:[(0,j.jsx)("div",{className:"font-bold",children:r("verifyAction.title",{action:t})}),(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)(h.$n,{onClick:()=>{l()},className:"my-3 modal-btn bg-gray-400",children:r("verifyAction.no")}),(0,j.jsx)(h.$n,{onClick:async()=>{await s(a,n),await o(i),u.clear(),u.open((0,j.jsx)(I,{close:()=>u.close(),id:a,action:t}))},className:"my-3 modal-btn bg-blue-600",children:r("verifyAction.yes")})]})]})]})})),P=(0,i.PA)((e=>{var t;let{close:s,usersArray:l,index:a,element:n}=e;const{t:o}=(0,y.Bd)();console.log("from edit user");const[i,c]=(0,r.useState)(l[a].roleNames),[g,f]=(0,r.useState)(!1);function p(e){const{value:t,checked:s}=e.target;c((e=>s?[...e,t]:e.filter((e=>e!==t))))}return(0,r.useEffect)((()=>{!async function(){await d.A.getRoles(d.A.token)}()}),[]),(0,j.jsxs)(h.aF,{show:!0,onClose:()=>{s(),v.doneMsg=null,v.error=null},size:"md",popup:!0,className:"nav",children:[(0,j.jsx)(h.aF.Header,{}),(0,j.jsx)(h.aF.Body,{className:"min-h-[78vh]",children:d.A.roles?(0,j.jsxs)("div",{className:"space-y-6",children:[(0,j.jsx)("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:o("editUserModal.header",{name:n.name})}),(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${v.error?"":"hidden"} text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",v.error]}),(0,j.jsx)("div",{className:`font-bold ${v.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:v.doneMsg&&v.doneMsg})]}),(0,j.jsxs)("form",{onSubmit:e=>async function(e,t,s){e.preventDefault(),f(!0),v.doneMsg=null,v.error=null;const l=e.target,a={name:l.name.value,surname:l.surname.value,emailAddress:l.emailAddress.value,userName:l.userName.value,roleNames:i};t[s]={...t[s],...a},await v.editUser(t[s],d.A.token),v.doneMsg?v.error=null:v.doneMsg=null,f(!1),v.getAllUsers(d.A.token)}(e,l,a),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{children:o("editUserModal.form.labels.userName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"user-name",name:"userName",type:"text",required:!0,autoComplete:"user-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.userName})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"name",className:"block text-sm/6 font-medium",children:o("editUserModal.form.labels.name")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"name",name:"name",type:"text",required:!0,autoComplete:"name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.name})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"surname",className:"block text-sm/6 font-medium",children:o("editUserModal.form.labels.surname")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"surname",name:"surname",type:"text",required:!0,autoComplete:"surname",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.surname})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"emailAddress",className:"block text-sm/6 font-medium",children:o("editUserModal.form.labels.email")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"emailAddress",name:"emailAddress",type:"email",required:!0,autoComplete:"emailAddress",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.emailAddress})})]}),(0,j.jsxs)("div",{className:"mt-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:o("editUserModal.roles.header")}),(0,j.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:o("editUserModal.roles.selected",{count:i.length,total:(null===(t=d.A.roles)||void 0===t?void 0:t.length)||0})})]}),(0,j.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>{var e;return c((null===(e=d.A.roles)||void 0===e?void 0:e.map((e=>e.normalizedName)))||[])},className:"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-colors duration-200",children:o("editUserModal.roles.selectAll")}),(0,j.jsx)("button",{type:"button",onClick:()=>c([]),className:"px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1 transition-colors duration-200",children:o("editUserModal.roles.clearAll")})]}),(0,j.jsx)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:function(){if(!d.A.roles)return[];const e=d.A.roles.reduce(((e,t)=>{const s=t.category||o("editUserModal.roles.general");return e[s]||(e[s]=[]),e[s].push(t),e}),{});return Object.entries(e).map((e=>{let[t,s]=e;return(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 pb-2 border-b border-gray-200 dark:border-gray-600",children:t}),(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(((e,s)=>(0,j.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[(0,j.jsx)("input",{type:"checkbox",checked:i.includes(e.normalizedName),value:e.normalizedName,id:`${t}-${e.name}`,onChange:p,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,j.jsxs)("label",{className:"ms-3 text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer flex-1",htmlFor:`${t}-${e.name}`,children:[(0,j.jsx)("div",{className:"font-medium",children:e.displayName||e.name}),e.description&&(0,j.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.description})]})]},`${t}-${s}`)))})]},t)}))}()})]}),g?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):(0,j.jsxs)("div",{className:"btns",children:[(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:o("editUserModal.form.buttons.done")}),(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-red-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-red-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"button",onClick:()=>{u.open((0,j.jsx)(L,{close:()=>u.close(),action:"delete",actionFunc:e=>async function(e){f(!0),await v.deleteUser(e,d.A.token),s()}(e),id:n.id,token:d.A.token,afterActionFunc:e=>v.getAllUsers(e),type:d.A.token}))},children:o("editUserModal.form.buttons.delete")}),n.isActive?(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-yellow-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-yellow-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"button",onClick:()=>{!async function(e){f(!0),await v.deactivate(e,d.A.token),v.getAllUsers(d.A.token),s()}(n.id,d.A.token)},children:o("editUserModal.form.buttons.deactivate")}):(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-green-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-green-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"button",onClick:()=>{!async function(e,t){f(!0),await v.active(e,t),v.getAllUsers(d.A.token),s()}(n.id,d.A.token)},children:o("editUserModal.form.buttons.activate")})]})]})]}):(0,j.jsx)(m.g,{className:"flex justify-center items-center",icon:x.z1G})})]})})),M=(0,i.PA)((e=>{const{t:t}=(0,y.Bd)(),[s,l]=(0,r.useState)(!1),a=(0,r.useCallback)((e=>e.map(((s,l)=>(0,j.jsxs)(h.Hj,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[(0,j.jsx)(h.nA,{className:"font-medium text-gray-900 dark:text-white",children:(0,j.jsx)(h.$n,{onClick:()=>u.open((0,j.jsx)(P,{close:()=>u.close(),usersArray:e,index:l,element:s})),className:"my-3 modal-btn",children:(0,j.jsx)(m.g,{icon:x.LFz})})}),(0,j.jsx)(h.nA,{className:"font-medium text-gray-900 dark:text-white",children:s.name}),(0,j.jsx)(h.nA,{className:"font-medium text-gray-900 dark:text-white",children:s.userName}),(0,j.jsx)(h.nA,{className:"font-medium text-gray-900 dark:text-white",children:s.emailAddress}),(0,j.jsx)(h.nA,{className:"font-medium text-gray-900 dark:text-white",children:s.isActive?t("usersModal.userStatus.active"):t("usersModal.userStatus.deactivate")})]},l)))),[t]);return(0,r.useEffect)((()=>{l(!0),v.getAllUsers(d.A.token),l(!1)}),[]),(0,j.jsx)(S.A,{permission:["Pages.Users"],children:(0,j.jsx)("div",{className:"show-users mt-10",children:(0,j.jsx)("div",{className:"overflow-x-auto",children:(0,j.jsx)(h.XI,{hoverable:!0,children:(0,j.jsxs)(h.BF,{className:"divide-y",children:[(0,j.jsxs)(h.Hj,{children:[(0,j.jsx)(h.nA,{children:" "}),(0,j.jsx)(h.nA,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:t("usersModal.table.headers.name")}),(0,j.jsx)(h.nA,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:t("usersModal.table.headers.userName")}),(0,j.jsx)(h.nA,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:t("usersModal.table.headers.email")}),(0,j.jsx)(h.nA,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:t("usersModal.table.headers.state")})]}),s?(0,j.jsx)(h.Hj,{children:(0,j.jsx)(h.nA,{colSpan:5,children:(0,j.jsx)("div",{className:"flex justify-center items-center h-full",children:t("usersModal.table.loading")})})}):v.allUsers?a(v.allUsers):(0,j.jsx)(h.Hj,{children:(0,j.jsx)(h.nA,{colSpan:5,children:(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0})})})]})})})})})})),F=(0,i.PA)((e=>{var t;let{close:s}=e;const{t:l}=(0,y.Bd)();console.log("from create new user");const a={userName:"",name:"",surname:"",emailAddress:"",roleNames:[],password:""},[n,o]=(0,r.useState)(a);function i(e){const{value:t,checked:s}=e.target;o((e=>({...e,roleNames:s?[...e.roleNames,t]:e.roleNames.filter((e=>e!==t))})))}return(0,r.useEffect)((()=>(async function(){await d.A.getRoles(d.A.token)}(),()=>{v.doneMsg=null,v.error=null})),[]),(0,j.jsxs)("div",{className:"w-full md:w-3/4",children:[(0,j.jsx)("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:l("createNewUserModal.header")}),(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${v.error?"":"hidden"} text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",v.error]}),(0,j.jsx)("div",{className:`font-bold ${v.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:v.doneMsg&&v.doneMsg})]}),(0,j.jsxs)("form",{className:"px-3",onSubmit:e=>async function(e){e.preventDefault(),v.doneMsg=null,v.error=null,await v.createNewUser(n,d.A.token),v.doneMsg?v.error=null:v.doneMsg=null,o(a)}(e),children:[(0,j.jsxs)("div",{className:"flex justify-between items-center flex-col md:flex-row md:gap-[100px]",children:[(0,j.jsxs)("div",{className:"flex-grow",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"name",className:"block text-sm/6 font-medium",children:l("createNewUserModal.form.labels.name")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"name",name:"name",type:"text",required:!0,autoComplete:"name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:n.name,onChange:e=>o((t=>({...t,name:e.target.value})))})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"surname",className:"block text-sm/6 font-medium",children:l("createNewUserModal.form.labels.surname")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"surname",name:"surname",type:"text",required:!0,autoComplete:"surname",value:n.surname,className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",onChange:e=>o((t=>({...t,surname:e.target.value})))})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"email",className:"block text-sm/6 font-medium",children:l("createNewUserModal.form.labels.email")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"email",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:n.emailAddress,onChange:e=>o((t=>({...t,emailAddress:e.target.value})))})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"user-name",className:"block text-sm/6 font-medium",children:l("createNewUserModal.form.labels.userName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"user-name",name:"user-name",type:"text",required:!0,autoComplete:"user-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:n.userName,onChange:e=>o((t=>({...t,userName:e.target.value})))})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"Password",className:"block text-sm/6 font-medium",children:l("createNewUserModal.form.labels.password")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"Password",name:"Password",type:"text",required:!0,autoComplete:"Password",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:n.password,onChange:e=>o((t=>({...t,password:e.target.value})))})})]})]}),(0,j.jsxs)("div",{className:"mt-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:l("createNewUserModal.form.roles.label")}),(0,j.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.roleNames.length," ",l("createNewUserModal.form.roles.of")," ",(null===(t=d.A.roles)||void 0===t?void 0:t.length)||0," ",l("createNewUserModal.form.roles.selected")]})]}),(0,j.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>o((e=>{var t;return{...e,roleNames:(null===(t=d.A.roles)||void 0===t?void 0:t.map((e=>e.normalizedName)))||[]}})),className:"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-colors duration-200",children:l("createNewUserModal.form.roles.SelectAll")}),(0,j.jsx)("button",{type:"button",onClick:()=>o((e=>({...e,roleNames:[]}))),className:"px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1 transition-colors duration-200",children:l("createNewUserModal.form.roles.ClearAll")})]}),(0,j.jsx)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:d.A.roles&&function(){if(!d.A.roles)return[];const e=d.A.roles.reduce(((e,t)=>{const s=t.category||`${l("createNewUserModal.form.roles.General")}`;return e[s]||(e[s]=[]),e[s].push(t),e}),{});return Object.entries(e).map((e=>{let[t,s]=e;return(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 pb-2 border-b border-gray-200 dark:border-gray-600",children:t}),(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(((e,s)=>(0,j.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[(0,j.jsx)("input",{type:"checkbox",checked:n.roleNames.includes(e.normalizedName),value:e.normalizedName,id:`${t}-${e.name}`,onChange:i,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,j.jsxs)("label",{className:"ms-3 text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer flex-1",htmlFor:`${t}-${e.name}`,children:[(0,j.jsx)("div",{className:"font-medium",children:e.displayName||e.name}),e.description&&(0,j.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.description})]})]},`${t}-${s}`)))})]},t)}))}()})]})]}),(0,j.jsx)("button",{className:"flex w-full md:w-2/12 justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:v.loading?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):l("createNewUserModal.form.submitButton.default")})]})]})})),T=(0,i.PA)((e=>{var t;let{close:s,roles:l,index:a,element:n,getAllRoles:o}=e;const{t:i}=(0,y.Bd)(),[c,g]=(0,r.useState)(l[a].grantedPermissions),[f,p]=(0,r.useState)(!1);function b(e){const{value:t,checked:s}=e.target;g((e=>s?[...e,t]:e.filter((e=>e!==t))))}return(0,r.useEffect)((()=>{!async function(){p(!0),await d.A.getAllPermissions(d.A.token),p(!1)}()}),[]),(0,j.jsxs)(h.aF,{size:"md",popup:!0,show:!0,onClose:()=>{s(),d.A.doneMsg=null,d.A.error=null},className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:i("editRoleModal.header",{name:n.name})}),(0,j.jsxs)(h.aF.Body,{className:"min-h-[78vh]",children:[(0,j.jsxs)("div",{className:"handel-alerts",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${d.A.error?"":"hidden"} text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",d.A.error]}),(0,j.jsx)("div",{className:`font-bold ${d.A.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:d.A.doneMsg&&d.A.doneMsg})]}),(0,j.jsx)("form",{"data-testid":"edit-role-form",onSubmit:e=>async function(e,t,s){e.preventDefault();try{p(!0),d.A.doneMsg=null,d.A.error=null;const l=e.target,a={name:l.name.value,displayName:l.displayName.value,description:l.description.value,grantedPermissions:c};t[s]={...t[s],...a},await d.A.editRole(t[s],d.A.token),d.A.doneMsg=i("editRoleModal.alerts.success")}catch(l){d.A.error=i("editRoleModal.alerts.error")}finally{p(!1)}}(e,l,a),children:d.A.allPermissions?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"role-name",className:"block text-sm/6 font-medium",children:i("editRoleModal.form.labels.roleName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{"data-testid":"name-input",id:"role-name",name:"name",type:"text",required:!0,autoComplete:"role-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.name})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"display-name",className:"block text-sm/6 font-medium",children:i("editRoleModal.form.labels.displayName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{"data-testid":"displayName-input",id:"display-name",name:"displayName",type:"text",required:!0,autoComplete:"display-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.displayName})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"description",className:"block text-sm/6 font-medium",children:i("editRoleModal.form.labels.description")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{"data-testid":"description-input",id:"description",name:"description",type:"text",required:!0,autoComplete:"description",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:n.description})})]}),(0,j.jsxs)("div",{className:"mt-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i("editRoleModal.permissions.header")}),(0,j.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("editRoleModal.permissions.selected",{count:c.length,total:(null===(t=d.A.allPermissions)||void 0===t?void 0:t.length)||0})})]}),(0,j.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>{var e;return g((null===(e=d.A.allPermissions)||void 0===e?void 0:e.map((e=>e.name)))||[])},className:"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-colors duration-200",children:i("editRoleModal.permissions.selectAll")}),(0,j.jsx)("button",{type:"button",onClick:()=>g([]),className:"px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1 transition-colors duration-200",children:i("editRoleModal.permissions.clearAll")})]}),(0,j.jsx)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:function(){if(!d.A.allPermissions)return[];const e=d.A.allPermissions.reduce(((e,t)=>{const s=t.category||i("editRoleModal.permissions.general");return e[s]||(e[s]=[]),e[s].push(t),e}),{});return Object.entries(e).map((e=>{let[t,s]=e;return(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 pb-2 border-b border-gray-200 dark:border-gray-600",children:t}),(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(((e,s)=>(0,j.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[(0,j.jsx)("input",{type:"checkbox",checked:c.includes(e.name),value:e.name,id:`${t}-${e.name}`,onChange:b,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,j.jsxs)("label",{className:"ms-3 text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer flex-1",htmlFor:`${t}-${e.name}`,children:[(0,j.jsx)("div",{className:"font-medium",children:e.displayName||e.name}),e.description&&(0,j.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.description})]})]},`${t}-${s}`)))})]},t)}))}()})]}),f?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):(0,j.jsxs)("div",{className:"btns",children:[(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:i("editRoleModal.form.buttons.done")}),(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-red-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-red-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"button",onClick:()=>{u.open((0,j.jsx)(L,{close:()=>u.close(),action:"delete",actionFunc:e=>async function(e){p(!0),await d.A.deleteRole(e,d.A.token),s()}(e),id:n.id,token:d.A.token,afterActionFunc:e=>o(e)}))},children:i("editRoleModal.form.buttons.delete")})]})]}):(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0})})]})]})})),R=(0,i.PA)((e=>{const{t:t}=(0,y.Bd)();async function s(){await d.A.getAllRoles(d.A.token)}return(0,r.useEffect)((()=>{s()}),[]),(0,j.jsx)("div",{className:"display-roles",children:d.A.allRoles?(0,j.jsx)("div",{className:"overflow-x-auto",children:(0,j.jsx)(h.XI,{hoverable:!0,children:(0,j.jsxs)(h.BF,{className:"divide-y",children:[(0,j.jsx)(h.Hj,{children:(0,j.jsx)(h.nA,{children:t("usersRolesModal.table.headers.roleName")})}),(l=d.A.allRoles,l.map(((e,t)=>(0,j.jsxs)(h.Hj,{className:"flex justify-between w-full",children:[(0,j.jsx)(h.nA,{className:"col-12 whitespace-nowrap font-medium text-gray-900 dark:text-white",children:e.name}),(0,j.jsx)(h.nA,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:(0,j.jsx)(h.$n,{onClick:()=>u.open((0,j.jsx)(T,{close:()=>u.close(),roles:l,index:t,element:e,getAllRoles:s})),className:"my-3 modal-btn",children:(0,j.jsx)(m.g,{icon:x.LFz})})})]},e.id))))]})})}):(0,j.jsx)(m.g,{"data-testid":"loading",className:"text-xl font-bold",icon:x.z1G,spin:!0})});var l})),$=(0,i.PA)((()=>{var e;const{t:t}=(0,y.Bd)();console.log("from create new role");const s={name:"",displayName:"",description:"",grantedPermissions:[]},[l,a]=(0,r.useState)(s),[n,o]=(0,r.useState)(!1);function i(e){const{value:t,checked:s}=e.target;a((e=>({...e,grantedPermissions:s?[...e.grantedPermissions,t]:e.grantedPermissions.filter((e=>e!==t))})))}function c(e){e.preventDefault(),d.A.doneMsg=null,d.A.error=null,async function(e){o(!0),await d.A.createNewRole(e,d.A.token),o(!1)}(l),d.A.doneMsg?d.A.error=null:d.A.doneMsg=null,a(s)}(0,r.useEffect)((()=>()=>{d.A.doneMsg=null,d.A.error=null}),[]);const u=(0,r.useMemo)((()=>(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"mt-2",children:[(0,j.jsx)("label",{htmlFor:"role-name",className:"block text-sm/6 font-medium",children:t("createNewRoleModal.form.labels.roleName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"role-name",name:"role-name",type:"text",required:!0,autoComplete:"role-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:l.name,onChange:e=>a((t=>({...t,name:e.target.value})))})})]}),(0,j.jsxs)("div",{className:"mt-2",children:[(0,j.jsx)("label",{htmlFor:"display-name",className:"block text-sm/6 font-medium",children:t("createNewRoleModal.form.labels.displayName")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"display-name",name:"display-name",type:"text",required:!0,autoComplete:"display-name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:l.displayName,onChange:e=>a((t=>({...t,displayName:e.target.value})))})})]}),(0,j.jsxs)("div",{className:"mt-2",children:[(0,j.jsx)("label",{htmlFor:"description",className:"block text-sm/6 font-medium",children:t("createNewRoleModal.form.labels.description")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"description",name:"description",type:"text",required:!0,autoComplete:"description",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",value:l.description,onChange:e=>a((t=>({...t,description:e.target.value})))})})]})]})),[l.description,l.displayName,l.name]);return(0,r.useEffect)((()=>{!async function(){o(!0),await d.A.getAllPermissions(d.A.token),o(!1)}()}),[]),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${d.A.error?"":"hidden"} text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",d.A.error]}),(0,j.jsx)("div",{className:`font-bold ${d.A.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:d.A.doneMsg&&d.A.doneMsg})]}),d.A.allPermissions?(0,j.jsxs)("form",{className:"px-3",onSubmit:e=>c(e),children:[(0,j.jsx)("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:t("createNewRoleModal.header")}),(0,j.jsxs)("div",{className:"flex justify-between items-center flex-col md:flex-row md:gap-[100px]",children:[(0,j.jsx)("div",{className:"flex-grow",children:u}),(0,j.jsxs)("div",{className:"mt-6",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t("createNewRoleModal.permissions.header")}),(0,j.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("createNewRoleModal.permissions.selected",{count:l.grantedPermissions.length,total:(null===(e=d.A.allPermissions)||void 0===e?void 0:e.length)||0})})]}),(0,j.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,j.jsx)("button",{type:"button",onClick:()=>a((e=>{var t;return{...e,grantedPermissions:(null===(t=d.A.allPermissions)||void 0===t?void 0:t.map((e=>e.name)))||[]}})),className:"px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 transition-colors duration-200",children:t("createNewRoleModal.permissions.selectAll")}),(0,j.jsx)("button",{type:"button",onClick:()=>a((e=>({...e,grantedPermissions:[]}))),className:"px-3 py-1.5 text-xs font-medium text-gray-600 bg-gray-50 border border-gray-200 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1 transition-colors duration-200",children:t("createNewRoleModal.permissions.clearAll")})]}),(0,j.jsx)("div",{className:"bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 max-h-96 overflow-y-auto",children:function(){const e=d.A.allPermissions.reduce(((e,s)=>{const l=s.category||t("createNewRoleModal.permissions.general");return e[l]||(e[l]=[]),e[l].push(s),e}),{});return Object.entries(e).map((e=>{let[t,s]=e;return(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 pb-2 border-b border-gray-200 dark:border-gray-600",children:t}),(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map(((e,s)=>(0,j.jsxs)("div",{className:"flex items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200",children:[(0,j.jsx)("input",{type:"checkbox",checked:l.grantedPermissions.includes(e.name),value:e.name,id:`${t}-${e.name}`,onChange:i,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,j.jsxs)("label",{className:"ms-3 text-sm font-medium text-gray-700 dark:text-gray-300 cursor-pointer flex-1",htmlFor:`${t}-${e.name}`,children:[(0,j.jsx)("div",{className:"font-medium",children:e.displayName||e.name}),e.description&&(0,j.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:e.description})]})]},`${t}-${s}`)))})]},t)}))}()})]})]}),(0,j.jsx)("button",{className:"flex w-full md:w-2/12 justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:n?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):t("createNewRoleModal.form.submitButton.default")})]}):(0,j.jsx)(m.g,{icon:x.z1G})]})})),_=(0,i.PA)((e=>{const{t:t}=(0,y.Bd)(),[s,l]=(0,r.useState)("Users"),a={Users:(0,j.jsx)(M,{}),Create_New_User:(0,j.jsx)(F,{}),Roles:(0,j.jsx)(R,{}),Create_New_Role:(0,j.jsx)($,{})};return(0,j.jsx)(S.A,{permission:["Pages.FloodWarnings","Pages.Tenants"],children:(0,j.jsxs)(h.aF,{size:"max-w-xl",show:!0,onClose:e.close,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:t("usersModal.header")}),(0,j.jsx)(h.aF.Body,{className:"min-h-[78vh]",children:(0,j.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,j.jsx)("div",{children:(0,j.jsx)(h.Bx,{"aria-label":t("management.sidebar.ariaLabel"),className:"w-full",children:(0,j.jsx)(h.F6,{children:(0,j.jsxs)(h.nk,{children:[(0,j.jsxs)(h.oj,{icon:C.YXz,label:t("management.sidebar.userManagement"),open:!0,children:[(0,j.jsx)(h.uk,{href:"#",onClick:()=>l("Users"),children:t("management.sidebar.users")}),(0,j.jsx)(h.uk,{href:"#",onClick:()=>l("Create_New_User"),children:t("management.sidebar.createNewUser")})]}),(0,j.jsxs)(h.oj,{icon:A.AYN,label:t("management.sidebar.rolesManagement"),children:[(0,j.jsx)(h.uk,{href:"#",onClick:()=>l("Roles"),children:t("management.sidebar.roles")}),(0,j.jsx)(h.uk,{href:"#",onClick:()=>l("Create_New_Role"),children:t("management.sidebar.createNewRole")})]})]})})})}),(0,j.jsx)("div",{className:"overflow-x-auto p-3 flex-grow",children:a[s]})]})})]})})})),B=(0,i.PA)((()=>{const{t:e}=(0,y.Bd)();return(0,j.jsxs)("div",{className:"fixed left-0 bottom-0 flex justify-center items-center w-full",style:{zIndex:400},children:[(0,j.jsx)(g.N_,{to:"/",className:"log-out fixed right-0 bottom-0 flex justify-center items-center w-12 h-12 md:w-16 md:h-16 rounded-full bg-red-400 transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 hover:cursor-pointer hover:bg-red-500 text-white mb-3  me-3 p-3",onClick:()=>d.A.logout(),children:(0,j.jsx)(m.g,{className:"text-3xl",icon:x.yBu})}),(0,j.jsx)("ul",{className:"flex",children:(0,j.jsxs)("li",{className:"ico relative p-3",children:[(0,j.jsx)("div",{className:"my-icon flex justify-center items-center w-12 h-12 md:w-16 md:h-16 rounded-full hover:cursor-pointer  text-white  me-3",children:(0,j.jsx)(m.g,{className:"text-3xl",icon:x._g1})}),(0,j.jsxs)("div",{className:"menu-box absolute bg-white left-2/4 p-3 w-44 rounded-md ",children:[(0,j.jsx)("h3",{children:e("List.header")}),(0,j.jsx)("div",{className:"users-management",children:(0,j.jsx)(h.$n,{className:"w-full my-3 modal-btn",onClick:()=>u.open((0,j.jsx)(_,{close:()=>u.close()})),children:e("List.usersManagement")})}),(0,j.jsx)("div",{className:"reset-password",children:(0,j.jsx)(h.$n,{className:"w-full my-3 modal-btn",onClick:()=>u.open((0,j.jsx)(k,{close:()=>u.close()})),children:e("List.resetPassModal")})}),(0,j.jsx)("div",{className:"reset-password",children:(0,j.jsx)(h.$n,{className:"w-full my-3 modal-btn",onClick:()=>u.open((0,j.jsx)(N,{close:()=>u.close()})),children:e("List.profileInformation")})}),(0,j.jsx)("div",{className:"change-password",children:(0,j.jsx)(h.$n,{className:"w-full my-3 modal-btn",onClick:()=>u.open((0,j.jsx)(w,{close:()=>u.close()})),children:e("List.changePassword")})})]})]})})]})})),W=(0,i.PA)((()=>(0,j.jsx)("div",{children:u.modalStack.map(((e,t)=>(0,j.jsx)("div",{show:!0,onClose:()=>u.close(),popup:!0,size:"md",style:{zIndex:1e3+t},children:e},t)))})));var z=s(6885),D=s(228),U=s.n(D);function O(e){return e?{Authorization:`Bearer ${e}`}:void 0}const H={getStationsByType:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return f.A.get("api/services/app/Thing/GetAllStationsByType",{params:{City:t,Type:e,County:s,AreaName:l,Town:a,Street:n}})},fetchStationById:async function(e){return f.A.get("/api/services/app/Thing/GetStationById",{params:{id:e}})},fetchObservations:async function(e,t,s){return f.A.get("/api/services/app/Observation/GetObservations",{params:{datastreamId:e,start:t,end:s}})},updateStation:async function(e,t,s,l){return f.A.put("/api/services/app/Thing/UpdateStation",t,{params:{id:e,type:l},headers:{"Content-Type":"application/json",...O(s)}})},deleteStation:async function(e,t){return f.A.delete("/api/services/app/Thing/DeleteStation",{params:{id:e},headers:O(t)})},fetchAllCities:async function(){return f.A.get("/api/services/app/Location/GetAllCities")},createStation:async function(e,t,s){return f.A.post("/api/services/app/Thing/CreateStation",e,{params:{type:s},headers:{"Content-Type":"application/json",...O(t)}})},getWaterLevelTypes:async function(){return f.A.get("/api/services/app/Thing/GetWaterLevelStationTypes")},getRainTypes:async function(){return f.A.get("/api/services/app/Thing/GetRainStationTypes")},fetchCountiesWithAreasAndStations:async function(e){return f.A.get("/api/services/app/Location/GetCountiesWithAreasAndStations",{params:{stationType:e}})}};const E=new class{constructor(){this.error=null,this.doneMsg=null,this.stationsByType={WaterLevel:null,Rain:null,Sewer:null,FloodNtc:null},this.selectedStationId=null,this.selectedStationType=null,this.stationsMetaByType={WaterLevel:null,Rain:null,Sewer:null,FloodNtc:null},this.isLoadingByType={WaterLevel:!1,Rain:!1,Sewer:!1,FloodNtc:null},this.WaterLevelIsActive=!0,this.RainIsActive=!1,this.SewerIsActive=!1,this.FloodNtcIsActive=!1,this.panelIsOpen=!1,this.panelSelectedType=null,this.displayCityName="",(0,c.l_)(this,{},{autoBind:!0})}get allWaterLevelStations(){return this.stationsByType.WaterLevel}get allRainLevelStations(){return this.stationsByType.Rain}get allSewerLevelStations(){return this.stationsByType.Sewer}get allFloodNtcStations(){return this.stationsByType.FloodNtc}get effectiveWaterLevelIsActive(){return this.panelIsOpen?"WaterLevel"===this.panelSelectedType||"WaterLevel"===this.selectedStationType&&this.selectedStationId:this.WaterLevelIsActive||"WaterLevel"===this.selectedStationType&&this.selectedStationId}get effectiveRainIsActive(){return this.panelIsOpen?"Rain"===this.panelSelectedType||"Rain"===this.selectedStationType&&this.selectedStationId:this.RainIsActive||"Rain"===this.selectedStationType&&this.selectedStationId}get effectiveSewerIsActive(){return this.panelIsOpen?"Sewer"===this.panelSelectedType||"Sewer"===this.selectedStationType&&this.selectedStationId:this.SewerIsActive||"Sewer"===this.selectedStationType&&this.selectedStationId}get effectiveFloodNtcIsActive(){return this.panelIsOpen?"FloodNtc"===this.panelSelectedType||"FloodNtc"===this.selectedStationType&&this.selectedStationId:this.FloodNtcIsActive||"FloodNtc"===this.selectedStationType&&this.selectedStationId}togglingWaterLevel(){this.WaterLevelIsActive=!this.WaterLevelIsActive}togglingRain(){this.RainIsActive=!this.RainIsActive}togglingSewer(){this.SewerIsActive=!this.SewerIsActive}togglingFloodNtc(){this.FloodNtcIsActive=!this.FloodNtcIsActive}setPanelOpen(e){this.panelIsOpen=e}setPanelSelectedType(e){this.panelSelectedType=e}clearMessages(){this.error=null,this.doneMsg=null}async getStationsByType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!this.stationsByType[e]||this.displayCityName!==t||this.isLoadingByType[e])try{var s,l,a,n;console.log(`[StationsStore] Loading stations for type: ${e}, city: ${t}`),this.displayCityName=t,this.isLoadingByType[e]=!0;const o=await H.getStationsByType(e,t);console.log(`[StationsStore] API response for ${e}:`,o);const i=null===(s=o.data)||void 0===s||null===(l=s.result)||void 0===l?void 0:l[0];console.log(`[StationsStore] Parsed result for ${e}:`,i);const r=null!==(a=null!==(n=null===i||void 0===i?void 0:i.stations)&&void 0!==n?n:i)&&void 0!==a?a:[];console.log(`[StationsStore] Final stations array for ${e}:`,r,"length:",r.length),this.stationsByType[e]=r,this.stationsMetaByType[e]=i,this.error=null,console.log(`[StationsStore] Successfully loaded ${r.length} stations for ${e}`)}catch(d){var o,i,r;console.error(`[StationsStore] Error loading stations for ${e}:`,d),this.error=(null===d||void 0===d||null===(o=d.response)||void 0===o||null===(i=o.data)||void 0===i||null===(r=i.error)||void 0===r?void 0:r.message)||d.message,this.stationsByType[e]=[]}finally{this.isLoadingByType[e]=!1}else console.log(`[StationsStore] Data already loaded for ${e} in city ${t}, skipping API call`)}setSelectedStation(e,t){this.selectedStationType=e,this.selectedStationId=t}clearSelectedStation(){this.selectedStationType=null,this.selectedStationId=null}isSelected(e,t){return this.selectedStationType===e&&this.selectedStationId===t}async getStationById(e){return H.fetchStationById(e)}async getLastObservations(e,t,s){return H.fetchObservations(e,t,s)}async getWaterLevelTypes(){return H.getWaterLevelTypes()}async getRainTypes(){return H.getRainTypes()}async editStation(e,t,s,l){try{const a=t||sessionStorage.getItem("token");await H.updateStation(s,e,a,l),this.doneMsg="Change successfully",this.error=null}catch(i){var a,n,o;this.error=(null===i||void 0===i||null===(a=i.response)||void 0===a||null===(n=a.data)||void 0===n||null===(o=n.error)||void 0===o?void 0:o.message)||i.message}}async createStation(e,t,s){try{console.log(e);const l=t||sessionStorage.getItem("token");await H.createStation(e,l,s),this.doneMsg="created successfully",this.error=null}catch(l){console.log(l)}}async deleteStation(e,t){try{const s=t||sessionStorage.getItem("token");await H.deleteStation(e,s),this.error=null}catch(n){var s,l,a;this.error=(null===n||void 0===n||null===(s=n.response)||void 0===s||null===(l=s.data)||void 0===l||null===(a=l.error)||void 0===a?void 0:a.message)||n.message}}async getAllCities(){return H.fetchAllCities()}async fetchCountiesWithAreasAndStations(e){return H.fetchCountiesWithAreasAndStations(e)}};var V=s(6036),q=s(2559);function X(e){let{selectedOption:t,type:s}=e;const{t:l}=(0,y.Bd)(),[a,n]=(0,r.useState)(1),o=Math.ceil((null===t||void 0===t?void 0:t.length)/10),i=null===t||void 0===t?void 0:t.slice(10*(a-1),10*a);function d(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}return(0,j.jsxs)("div",{className:"data-table overflow-x-auto",children:[(0,j.jsxs)(h.XI,{hoverable:!0,striped:!0,children:[(0,j.jsxs)(h.XI.Head,{children:[(0,j.jsx)(h.XI.HeadCell,{className:"cursor-pointer",children:l("stationsTable.headers.time")}),(0,j.jsx)(h.XI.HeadCell,{children:s})]}),(0,j.jsx)(h.XI.Body,{className:"divide-y",children:i.map(((e,t)=>(0,j.jsxs)(h.XI.Row,{children:[(0,j.jsx)(h.XI.Cell,{children:d(e.obsTimestamp)}),(0,j.jsx)(h.XI.Cell,{children:e.result})]},t)))})]}),(0,j.jsx)("div",{className:"w-full flex flex-wrap justify-center gap-1 mt-4 overflow-hidden",children:(0,j.jsx)(h.dK,{layout:"pagination",currentPage:a,totalPages:o,onPageChange:e=>n(e),previousLabel:"",nextLabel:"",showIcons:!0})})]})}const G=(0,i.PA)((e=>{let{element:t,close:s,type:l,getStationById:a}=e;console.log(l);const{t:n}=(0,y.Bd)(),[o,i]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1);return(0,j.jsxs)(h.aF,{size:"lg",show:!0,onClose:s,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:n("editStationModal.header",{name:(null===t||void 0===t?void 0:t.name)||"Unknown"})}),(0,j.jsxs)(h.aF.Body,{className:"min-h-[70vh]",children:[(0,j.jsxs)("div",{className:"handel-actions",children:[(0,j.jsxs)("div",{className:`font-bold text-red-600 mt-3 ${E.error?"":"hidden"} text-center`,children:[(0,j.jsx)(m.g,{icon:x.JAe,beat:!0,style:{color:"#c70000"}})," ",E.error]}),(0,j.jsx)("div",{className:`font-bold ${E.doneMsg?"":"hidden"} text-green-600 mt-3 text-center`,children:E.doneMsg})]}),(0,j.jsxs)("form",{onSubmit:e=>async function(e,n){var o;e.preventDefault(),i(!0);const r=e.target;let c={longitude:+r.longitude.value,latitude:+r.latitude.value,alertL1:+r.alertL1.value,alertL2:+r.alertL2.value,name:r.name.value};null!==(o=r.alertL3)&&void 0!==o&&o.value&&(c={...c,alertL3:+r.alertL3.value}),console.log(c),await E.editStation(c,d.A.token,n,l),E.doneMsg?(E.error=null,s(),await a(t.id),E.doneMsg=null):E.doneMsg=null,i(!1)}(e,t.id),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"name",className:"block text-sm/6 font-medium",children:n("editStationModal.form.labels.name")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"name",name:"name",type:"text",required:!0,autoComplete:"name",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.name})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"longitude",className:"block text-sm/6 font-medium",children:n("editStationModal.form.labels.longitude")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"longitude",name:"longitude",type:"number",required:!0,autoComplete:"longitude",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.longitude})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"latitude",className:"block text-sm/6 font-medium",children:n("editStationModal.form.labels.latitude")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"latitude",name:"latitude",type:"number",required:!0,autoComplete:"latitude",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.latitude})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"alertL1",className:"block text-sm/6 font-medium text-red-700",children:n("editStationModal.form.labels.alertL1")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"alertL1",name:"alertL1",type:"number",required:!0,autoComplete:"alertL1",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.alertL1})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"alertL2",className:"block text-sm/6 font-medium text-orange-500",children:n("editStationModal.form.labels.alertL2")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"alertL2",name:"alertL2",type:"number",required:!0,autoComplete:"alertL2",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.alertL2})})]}),"number"===typeof t.alertL3?(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"alertL3",className:"block text-sm/6 font-medium text-green-600",children:n("editStationModal.form.labels.alertL3")}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"alertL3",name:"alertL3",type:"number",required:!0,autoComplete:"alertL3",className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6",defaultValue:t.alertL3})})]}):"",(0,j.jsx)("button",{className:`flex w-full justify-center rounded-md ${c?"bg-gray-600":"bg-green-600"} px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm  ${c?"hover:bg-gray-500":"hover:bg-green-500"}  hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3`,type:"button",onClick:()=>{u((e=>!e))},children:n(c?"editStationModal.form.buttons.less":"editStationModal.form.buttons.more")}),(0,j.jsxs)("div",{className:""+(c?"":"hidden"),children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"addR_E",className:"block text-sm font-medium",children:"addR_E"}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"addR_E",name:"addR_E",type:"text",defaultValue:t.addR_E,className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 outline-gray-300 \r placeholder:text-gray-400 focus:outline focus:outline-2 focus:outline-indigo-600 sm:text-sm"})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium",children:"address"}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"address",name:"address",type:"text",defaultValue:t.address,className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 outline-gray-300 \r placeholder:text-gray-400 focus:outline focus:outline-2 focus:outline-indigo-600 sm:text-sm"})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"admicode",className:"block text-sm font-medium",children:"admicode"}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"admicode",name:"admicode",type:"number",defaultValue:t.admicode,className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 outline-gray-300 \r placeholder:text-gray-400 focus:outline focus:outline-2 focus:outline-indigo-600 sm:text-sm"})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"alert",className:"block text-sm font-medium text-red-600",children:"alert"}),(0,j.jsx)("div",{className:"mt-2",children:(0,j.jsx)("input",{id:"alert",name:"alert",type:"number",defaultValue:t.alert,className:"block w-full text-black rounded-md bg-white px-3 py-1.5 text-base outline outline-1 outline-gray-300 \r placeholder:text-gray-400 focus:outline focus:outline-2 focus:outline-indigo-600 sm:text-sm"})})]})]}),o?(0,j.jsx)(m.g,{className:"text-xl font-bold",icon:x.z1G,spin:!0}):(0,j.jsx)("div",{className:"btns",children:(0,j.jsx)("button",{className:"flex w-full justify-center rounded-md bg-blue-600 px-3 py-1.5 text-sm/6 font-semibold text-white shadow-sm hover:bg-blue-500 hover:cursor-pointer focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-3",type:"submit",children:n("editStationModal.form.buttons.done")})})]})]})]})}));var J=s(108),K=s(5748),Y=s(7734),Z=s(2185),Q=s(760),ee=s(9802),te=s(7659),se=s(3243);function le(e){let{chartData:t,selectedOption:s,waterLevelStation:l,type:a,getStationById:n}=e;const{t:o}=(0,y.Bd)(),i=(0,r.useMemo)((()=>t&&0!==t.length?t.reverse().map(((e,t)=>({...e,index:t}))):[{time:"",value:0,index:0}]),[t]);return(0,j.jsxs)(j.Fragment,{children:[d.A.userPermissions.includes("Stations.Update")&&(0,j.jsxs)("div",{className:"flex gap-2",children:[(0,j.jsx)(h.$n,{onClick:()=>u.open((0,j.jsx)(G,{close:()=>u.close(),element:l,type:a,getStationById:n})),className:"my-3 modal-btn",children:(0,j.jsx)(m.g,{icon:x.LFz})}),(0,j.jsx)(h.$n,{onClick:()=>u.open((0,j.jsx)(L,{close:()=>u.close(),action:"delete",actionFunc:e=>E.deleteStation(e),id:l.id,token:d.A.token,afterActionFunc:e=>E.getStationsByType(e),type:a})),className:"my-3 modal-btn bg-red-600 delete-btn",children:(0,j.jsx)(m.g,{icon:x.yLS})})]}),(0,j.jsx)("div",{className:"h-[50vh] overflow-y-auto",children:(0,j.jsx)(J.u,{className:"overflow-hidden outline-none focus:outline-none border-0 focus:border-0",width:"100%",height:"100%",children:(0,j.jsxs)(K.b,{data:i,children:[(0,j.jsx)(Y.d,{strokeDasharray:"3 3"}),(0,j.jsx)(Z.W,{dataKey:"time",hide:!0}),(0,j.jsx)(Z.W,{dataKey:"index",tick:e=>{var t;let{x:s,y:l,payload:a}=e;const n=((null===(t=i[a.value])||void 0===t?void 0:t.time)||"").toString().split("\n");return(0,j.jsx)("text",{x:s,y:l-4,textAnchor:"middle",fill:"#666",children:n.map(((e,t)=>(0,j.jsx)("tspan",{x:s,dy:0===t?0:15,children:e},t)))})},ticks:[0,Math.floor(i.length/2),i.length-1],tickFormatter:e=>i[e].time}),(0,j.jsx)(Q.h,{domain:[()=>{var e;const t=(null===s||void 0===s?void 0:s.map((e=>e.result)))||[],a=t.length>0?Math.min(...t)-5:null!==(e=l.alertL3)&&void 0!==e?e:-5;return Math.floor(a)},()=>{const e=l.alertL1+5;return Math.floor(e)}]}),(0,j.jsx)(ee.m,{labelFormatter:e=>(0,j.jsx)("span",{style:{whiteSpace:"pre-line"},children:i[e].time})}),(0,j.jsx)(te.N,{type:"monotone",dataKey:"value",stroke:"#007bff",strokeWidth:2,dot:!1}),(0,j.jsx)(se.e,{y:l.alertL1,label:{value:o("stationsChart.referenceLines.danger"),position:"insideBottom",fill:"red"},stroke:"red",strokeDasharray:"3 3"}),(0,j.jsx)(se.e,{y:l.alertL2,label:{value:o("stationsChart.referenceLines.warning"),position:"insideBottom",fill:"orange"},stroke:"orange",strokeDasharray:"3 3"}),(0,j.jsx)(se.e,{y:l.alertL3,label:{value:o("stationsChart.referenceLines.safe"),position:"insideBottom",fill:"green"},stroke:"green",strokeDasharray:"3 3"})]})})})]})}const ae=e=>{if(!e)return"-";return{AboveLevel_1:"Danger",AboveLevel_2:"Warning",AboveLevel_3:"Normal",normal:"Normal",Danger:"Danger",Warning:"Warning",Normal:"Normal",unknown:"Unknown",lvl_above_1:"Level 1 Warning",lvl_above_2:"Level 2 Warning",lvl_above_3:"Normal",level_above_1:"Level 1 Warning",level_above_2:"Level 2 Warning",level_above_3:"Normal",above_level_1:"Level 1 Warning",above_level_2:"Level 2 Warning",above_level_3:"Normal"}[e]||e},ne=e=>{if(!e)return"";return{AboveLevel_1:"bg-red-100 text-red-800",AboveLevel_2:"bg-yellow-100 text-yellow-800",AboveLevel_3:"bg-green-100 text-green-800",Normal:"bg-green-100 text-green-800",Danger:"bg-red-100 text-red-800",Warning:"bg-yellow-100 text-yellow-800",unknown:"bg-gray-100 text-gray-800",lvl_above_1:"bg-red-100 text-red-800",lvl_above_2:"bg-yellow-100 text-yellow-800",lvl_above_3:"bg-green-100 text-green-800",level_above_1:"bg-red-100 text-red-800",level_above_2:"bg-yellow-100 text-yellow-800",level_above_3:"bg-green-100 text-green-800",above_level_1:"bg-red-100 text-red-800",above_level_2:"bg-yellow-100 text-yellow-800",above_level_3:"bg-green-100 text-green-800"}[e]||""};function oe(e){var t,s,l,a,n,o,i,r,d,c,u,m,x,g,f,p,b,v,w;let{waterLevelStation:N,type:S}=e;const{t:k}=(0,y.Bd)(),A={Sewer:"WaterInner",FloodNtc:"WaterInner",WaterLevel:"WaterLevel",Rain:"Past10Min"};function C(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}return(0,j.jsxs)(h.XI,{striped:!0,hoverable:!0,children:[(0,j.jsx)(h.XI.Head,{children:(0,j.jsx)(h.XI.HeadCell,{colSpan:4,className:"text-center",children:k("infDataTable.header")})}),(0,j.jsxs)(h.XI.Body,{className:"divide-y",children:[(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.state")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:(0,j.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ne(null===(t=N.datastreams)||void 0===t||null===(s=t.filter((e=>e.name===A[S]))[0])||void 0===s||null===(l=s.latestObservation)||void 0===l?void 0:l.warningStatus)}`,children:ae(null===(a=N.datastreams)||void 0===a||null===(n=a.filter((e=>e.name===A[S]))[0])||void 0===n||null===(o=n.latestObservation)||void 0===o?void 0:o.warningStatus)})}),(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.stationNumber")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:null===N||void 0===N?void 0:N.stationNumber})]}),(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.level1Alert")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:null===N||void 0===N||null===(i=N.alertL1)||void 0===i?void 0:i.toFixed(2)}),(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.level2Alert")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:null===N||void 0===N||null===(r=N.alertL2)||void 0===r?void 0:r.toFixed(2)})]}),(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.longitude")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:null===N||void 0===N?void 0:N.longitude}),(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.latitude")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4",children:null===N||void 0===N?void 0:N.latitude})]}),(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.LastValue")}),(0,j.jsx)("td",{className:"w-1/4 text-center p-4 border",children:null===(d=N.datastreams)||void 0===d||null===(c=d.filter((e=>e.name===A[S]))[0])||void 0===c||null===(u=c.latestObservation)||void 0===u?void 0:u.lastResult}),(0,j.jsx)("th",{scope:"row",className:"w-1/4 text-center font-semibold bg-slate-200 p-4",children:k("infDataTable.columns.time")}),(0,j.jsxs)("td",{className:"w-1/4 text-center p-4",children:[null===(m=C(null===(x=N.datastreams)||void 0===x||null===(g=x.filter((e=>e.name===A[S]))[0])||void 0===g||null===(f=g.latestObservation)||void 0===f?void 0:f.lastTimestamp))||void 0===m?void 0:m.slice(0,10),(0,j.jsx)("br",{}),(0,j.jsx)("br",{}),null===(p=C(null===(b=N.datastreams)||void 0===b||null===(v=b.filter((e=>e.name===A[S]))[0])||void 0===v||null===(w=v.latestObservation)||void 0===w?void 0:w.lastTimestamp))||void 0===p?void 0:p.slice(10,22)]})]})]})]})}var ie=s(6350),re=s(713),de=s(5963);function ce(e){let{station:t,waterLevelValue:s}=e;const{jsonX:l,jsonY:a}=t||{},{data:n,yDomain:o,xDomain:i}=(0,r.useMemo)((()=>{try{const e=Array.isArray(l)?l:JSON.parse(l||"[]"),t=Array.isArray(a)?a:JSON.parse(a||"[]"),n=Math.min(e.length,t.length),o=[];for(let s=0;s<n;s++){const l=Number(e[s]),a=Number(t[s]);Number.isFinite(l)&&Number.isFinite(a)&&o.push({x:l,y:a})}o.sort(((e,t)=>e.x-t.x));const i=Number.isFinite(s)?Number(s):void 0,r=o.map((e=>{const t=void 0!==i?Math.min(e.y,i):e.y,s=void 0!==i?Math.max(0,i-e.y):0;return{x:e.x,y:e.y,bedClamped:t,waterSegment:s}})),d=o.map((e=>e.y)),c=Math.min(...d,Number.isFinite(s)?s:1/0),u=Math.max(...d,Number.isFinite(s)?s:-1/0),m=Math.max(1,.1*(u-c)),x=o.map((e=>e.x)),h=Math.min(...x);return{data:r,yDomain:[c-m,u+m],xDomain:[h,Math.max(...x)]}}catch(e){return{data:[],yDomain:[0,1],xDomain:[0,1]}}}),[l,a,s]);return n&&0!==n.length?(0,j.jsx)("div",{className:"w-full md:2/3 h-[50vh]",children:(0,j.jsx)(J.u,{width:"100%",height:"100%",children:(0,j.jsxs)(ie.X,{data:n,margin:{top:10,right:10,left:10,bottom:28},children:[(0,j.jsx)(Y.d,{vertical:!0,horizontal:!1,strokeDasharray:"2 6"}),(0,j.jsx)(Z.W,{dataKey:"x",type:"number",domain:i,tick:{fontSize:12},label:{value:"Distance",position:"insideBottom",dy:16}}),(0,j.jsx)(Q.h,{domain:o,tick:{fontSize:12},label:{value:"Elevation",angle:-90,position:"insideLeft"}}),(0,j.jsx)(ee.m,{formatter:(e,t)=>"y"===t?[e,"Elevation"]:"bedClamped"===t?[e,"Riverbed"]:"waterSegment"===t?[e,"Water"]:[e,t],labelFormatter:e=>`Distance: ${e}`,content:e=>{let{active:l,payload:a,label:n}=e;if(!l||!a||!a.length)return null;const o=[];return null!==t&&void 0!==t&&t.alertL1&&o.push(`Danger: ${t.alertL1}`),null!==t&&void 0!==t&&t.alertL2&&o.push(`Warning: ${t.alertL2}`),Number.isFinite(s)&&o.push(`Current: ${s}`),(0,j.jsxs)("div",{className:"bg-white p-3 border border-gray-300 rounded shadow-lg",children:[(0,j.jsxs)("p",{className:"font-semibold",children:["Distance: ",n]}),a.map(((e,t)=>(0,j.jsxs)("p",{style:{color:e.color},children:[e.name,": ",e.value]},t))),o.length>0&&(0,j.jsxs)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:[(0,j.jsx)("p",{className:"font-semibold text-xs",children:"Alert Levels:"}),o.map(((e,t)=>(0,j.jsx)("p",{className:"text-xs",children:e},t)))]})]})}}),(0,j.jsx)(re.s,{verticalAlign:"top",height:24}),(0,j.jsx)(de.Gk,{type:"monotone",dataKey:"bedClamped",stackId:"bed",stroke:"#6b7280",fill:"#d6d3d1",name:"Riverbed",fillOpacity:.7,isAnimationActive:!1}),(0,j.jsx)(de.Gk,{type:"monotone",dataKey:"waterSegment",stackId:"bed",stroke:"#2563eb",fill:"#60a5fa",name:"Water",fillOpacity:.7,isAnimationActive:!1}),(0,j.jsx)(te.N,{type:"monotone",dataKey:"y",stroke:"#374151",dot:!1,name:"Bed profile"}),(null===t||void 0===t?void 0:t.alertL1)&&(0,j.jsx)(se.e,{y:t.alertL1,stroke:"red",strokeWidth:2,strokeDasharray:"3 3",label:{value:"Danger",position:"insideTopLeft",fill:"red",fontSize:10,offset:5}}),(null===t||void 0===t?void 0:t.alertL2)&&(0,j.jsx)(se.e,{y:t.alertL2,stroke:"orange",strokeWidth:2,strokeDasharray:"3 3",label:{value:"Warning",position:"insideTopLeft",fill:"orange",fontSize:10,offset:5}}),Number.isFinite(s)&&(0,j.jsx)(se.e,{y:s,stroke:"#2563eb",strokeWidth:3,strokeDasharray:"6 3",label:{value:`Current: ${s}`,position:"insideTopLeft",fill:"#2563eb",fontSize:10,fontWeight:"bold",offset:5}})]})})}):(0,j.jsx)("div",{className:"w-full h-[36vh] flex items-center justify-center text-sm text-gray-500",children:"Cross-section data unavailable"})}function ue(e){let{type:t,currentValue:s,alertL1:l,alertL2:a,maxValue:n=10}=e;const{t:o}=(0,y.Bd)(),i=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=document.createElement("script");e.src="https://www.gstatic.com/charts/loader.js",e.onload=()=>{window.google.charts.load("current",{packages:["gauge"]}),window.google.charts.setOnLoadCallback(t)},document.head.appendChild(e);const t=()=>{if(!window.google||!i.current)return;const e=window.google.visualization.arrayToDataTable([["Label","Value"],["Water Level",s||0]]),t=Math.max(l||0,a||0),o=Math.min(l||0,a||0),r={height:250,redFrom:t,redTo:n,yellowFrom:o,yellowTo:t,greenFrom:0,greenTo:o,minorTicks:5,majorTicks:["0",(.25*n).toFixed(1),(.5*n).toFixed(1),(.75*n).toFixed(1),n.toFixed(1)],min:0,max:n,animation:{duration:1e3,easing:"inAndOut"},greenColor:"#10b981",yellowColor:"#f7b519",redColor:"#ef4444",fontSize:16};new window.google.visualization.Gauge(i.current).draw(e,r),setTimeout((()=>{const e=i.current.querySelector('text[text-anchor="middle"]');e&&e.setAttribute("font-size","10")}),100)};return()=>{e.parentNode&&e.parentNode.removeChild(e)}}),[s,l,a,n]),(0,j.jsxs)("div",{className:"w-full bg-white rounded-lg border border-gray-200 p-6",children:[(0,j.jsx)("div",{className:"text-center mb-6",children:(0,j.jsx)("h3",{className:"text-lg font-semibold text-blue-600",children:o("gaugeChart.header",{type:t})})}),(0,j.jsx)("div",{className:"flex justify-center",children:(0,j.jsx)("div",{ref:i})}),(0,j.jsxs)("div",{className:"text-center mt-4",children:[(0,j.jsx)("div",{className:"text-2xl font-bold text-gray-800",children:(null===s||void 0===s?void 0:s.toFixed(1))||"0.0"}),(0,j.jsx)("div",{className:"text-sm text-gray-500",children:o("gaugeChart.currentLevel")})]}),(0,j.jsxs)("div",{className:"flex justify-center space-x-6 mt-6 text-sm",children:[(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-2"}),(0,j.jsx)("span",{className:"text-gray-700",children:o("gaugeChart.legend.normal",{from:0,to:Math.min(l||0,a||0).toFixed(1)})})]}),(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)("div",{className:"w-3 h-3 bg-[#f7b519] rounded-full mr-2"}),(0,j.jsx)("span",{className:"text-gray-700",children:o("gaugeChart.legend.warning",{from:Math.min(l||0,a||0).toFixed(1),to:Math.max(l||0,a||0).toFixed(1)})})]}),(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-2"}),(0,j.jsx)("span",{className:"text-gray-700",children:o("gaugeChart.legend.danger",{from:Math.max(l||0,a||0).toFixed(1),to:null===n||void 0===n?void 0:n.toFixed(1)})})]})]})]})}const me=(0,i.PA)((e=>{var t,s,l,a,n,o,i,d,c,u,g,f;let{elementId:p,close:b,stationName:v,type:w}=e;console.log("from stationModal");const{t:N}=(0,y.Bd)(),[S,k]=(0,r.useState)(),[A,C]=(0,r.useState)(),[I,L]=(0,r.useState)("timeseries"),P={Sewer:"WaterInner",FloodNtc:"WaterInner",WaterLevel:"WaterLevel",Rain:"Past10Min"};function M(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}const F=(0,r.useMemo)((()=>{if(!A||!p)return"";return A.map((e=>({time:`\n      (${M(e.obsTimestamp).slice(0,1).split(",")[0].split(/\//g)[0]}-${M(e.obsTimestamp).slice(2,4).split(",")[0].split(/\//g)[0]})\n\n      ${M(e.obsTimestamp).slice(10,21)}\n      `,value:e.result})))}),[A,p]);async function T(e){try{const t=await E.getStationById(e);k(t.data.result),console.log(t.data.result)}catch(t){console.log(t)}}async function R(e,t){const s=new Date,l=new Date(s.getTime()-60*t*60*1e3).toISOString();console.log("now",s.toISOString()),console.log("lastHours",l);try{const t=await E.getLastObservations(e,l,s.toISOString());C(t.data.result),console.log("LastObservations data",t.data.result)}catch(a){console.log(a)}}(0,r.useEffect)((()=>{T(p)}),[p]);return(0,r.useEffect)((()=>{var e,t;S&&(R(null===S||void 0===S||null===(e=S.datastreams)||void 0===e||null===(t=e.filter((e=>e.name===P[w]))[0])||void 0===t?void 0:t.id,24),L("timeseries"))}),[S]),(0,j.jsxs)(h.aF,{size:"max-w-xl",show:!0,onClose:b,className:"nav",children:[(0,j.jsx)(h.aF.Header,{children:N("stationsModal.header",{stationName:v,station:null===S||void 0===S?void 0:S.name})+""+($=null===S||void 0===S?void 0:S.city,console.log("city",$),"Unknown"!==$&&$?` - ${$}`:"")}),(0,j.jsx)(h.aF.Body,{className:"min-h-[78vh]  overflow-y-auto ",children:S?(0,j.jsxs)("div",{className:"overflow-y-auto p-4 bg-white rounded-lg",children:[(0,j.jsx)("h2",{className:"text-sm mb-3",children:N("stationsModal.labels.stationId",{id:null===S||void 0===S?void 0:S.id})}),F?(0,j.jsxs)("div",{className:"flex flex-col justify-center md:flex-row gap-4",children:[(0,j.jsxs)("div",{className:"w-full md:w-1/3",children:[(0,j.jsxs)(h.l6,{onChange:e=>{var t,s;R(null===S||void 0===S||null===(t=S.datastreams)||void 0===t||null===(s=t.filter((e=>e.name===P[w]))[0])||void 0===s?void 0:s.id,e.target.value)},className:"w-full",children:[(0,j.jsx)("option",{value:24,children:N("stationsModal.selectOptions.twentyFourHours")}),(0,j.jsx)("option",{value:6,children:N("stationsModal.selectOptions.sixHours")}),(0,j.jsx)("option",{value:3,children:N("stationsModal.selectOptions.threeHours")})]}),(0,j.jsx)(X,{type:w,selectedOption:A})]}),(0,j.jsxs)("div",{className:"w-full md:w-2/3",children:[(0,j.jsx)(ue,{type:w,currentValue:null===(t=S.datastreams)||void 0===t||null===(s=t.filter((e=>e.name===P[w]))[0])||void 0===s||null===(l=s.latestObservation)||void 0===l?void 0:l.lastResult,alertL1:null===S||void 0===S?void 0:S.alertL1,alertL2:null===S||void 0===S?void 0:S.alertL2,maxValue:1.2*Math.max((null===S||void 0===S?void 0:S.alertL2)||0,(null===S||void 0===S?void 0:S.alertL1)||0,(null===(a=S.datastreams)||void 0===a||null===(n=a.filter((e=>e.name===P[w]))[0])||void 0===n||null===(o=n.latestObservation)||void 0===o?void 0:o.lastResult)||0)}),"WaterLevel"===w&&null!==S&&void 0!==S&&S.jsonX&&null!==S&&void 0!==S&&S.jsonY?(0,j.jsx)("div",{className:"flex items-center justify-end mt-5",children:(0,j.jsxs)("div",{role:"tablist","aria-label":"Chart view",className:"relative grid grid-cols-2 p-1 bg-slate-100 rounded-full shadow-sm select-none",children:[(0,j.jsx)("span",{className:"pointer-events-none absolute inset-y-1 w-1/2 rounded-full bg-white shadow transition-transform duration-300 ease-out "+("timeseries"===I?"translate-x-0":"translate-x-full"),"aria-hidden":!0}),(0,j.jsx)("button",{role:"tab","aria-selected":"timeseries"===I,onClick:()=>L("timeseries"),className:"relative z-10 px-3 py-1.5 text-sm font-medium rounded-full text-center transition-colors focus:outline-none "+("timeseries"===I?"text-blue-700":"text-slate-600 hover:text-slate-800"),children:"Time series"}),(0,j.jsx)("button",{role:"tab","aria-selected":"crosssection"===I,onClick:()=>L("crosssection"),className:"relative z-10 px-3 py-1.5 text-sm font-medium rounded-full text-center transition-colors focus:outline-none "+("crosssection"===I?"text-blue-700":"text-slate-600 hover:text-slate-800"),children:"River cross-section"})]})}):null,"timeseries"===I&&(0,j.jsx)(le,{chartData:F,selectedOption:A,waterLevelStation:S,type:w,getStationById:T}),"WaterLevel"===w&&"crosssection"===I&&(null===S||void 0===S?void 0:S.jsonX)&&(null===S||void 0===S?void 0:S.jsonY)&&(0,j.jsx)(ce,{station:S,waterLevelValue:null!==(i=null===S||void 0===S||null===(d=S.datastreams)||void 0===d||null===(c=d.filter((e=>e.name===P[w]))[0])||void 0===c||null===(u=c[0])||void 0===u||null===(g=u.latestObservation)||void 0===g?void 0:g.lastResult)&&void 0!==i?i:null===A||void 0===A||null===(f=A[(null===A||void 0===A?void 0:A.length)-1])||void 0===f?void 0:f.result}),(0,j.jsx)("div",{className:"station-data block lg:block w-full mt-2",children:(0,j.jsx)(oe,{waterLevelStation:S,selectedOption:A,type:w})})]})]}):(0,j.jsx)(h.Fc,{color:"warning",children:N("stationsModal.alerts.dataUnavailable")})]}):(0,j.jsx)("div",{className:"min-h-[70vh] flex justify-center items-center",children:(0,j.jsx)(m.g,{icon:x.z1G,size:"2xl",spin:!0})})})]});var $}));var xe=s(5548);const he=(0,i.PA)((0,r.forwardRef)(((e,t)=>{const{t:s}=(0,y.Bd)(),{allWaterLevelStations:l}=E,a=(0,r.useRef)();(0,r.useEffect)((()=>{const e=document.createElement("style");return e.textContent="\n        .custom-tooltip .leaflet-tooltip {\n          background: transparent !important;\n          border: none !important;\n          box-shadow: none !important;\n          padding: 0 !important;\n        }\n        .custom-tooltip .leaflet-tooltip-top:before {\n          border-top-color: white !important;\n        }\n        .custom-tooltip .leaflet-tooltip-bottom:before {\n          border-bottom-color: white !important;\n        }\n        .custom-tooltip .leaflet-tooltip-left:before {\n          border-left-color: white !important;\n        }\n        .custom-tooltip .leaflet-tooltip-right:before {\n          border-right-color: white !important;\n        }\n      ",document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[]),(0,r.useImperativeHandle)(t,(()=>({declusterStation:e=>{if(a.current){const t=a.current,s=l.find((t=>t.id===e));if(s&&s.latitude&&s.longitude){if("WaterLevel"===E.selectedStationType&&E.selectedStationId===e)return;const s=t.getLayers().find((t=>t.options&&t.options.stationId===e));s&&t.zoomToShowLayer(s,(()=>{}))}}}})));const n=(0,z.qV)((0,j.jsx)(m.g,{icon:x.yzd,className:"border border-blue-700 text-blue-800 bg-blue-300 rounded-full p-2"})),o=U().divIcon({html:n,className:"fa-icon-marker",iconSize:[32,32],iconAnchor:[16,32]}),i=U().divIcon({html:(0,z.qV)((0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("span",{className:"absolute inset-0 -m-1 rounded-full bg-blue-400/40 animate-ping"}),(0,j.jsx)(m.g,{icon:x.yzd,className:"relative border-2 border-white ring-8 ring-blue-500 text-blue-900 bg-blue-300 rounded-full p-2 shadow-2xl"})]})),className:"fa-icon-marker-selected",iconSize:[48,48],iconAnchor:[24,48]});function d(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}const c=(0,r.useMemo)((()=>{if(!l)return"";if("WaterLevel"===E.selectedStationType&&E.selectedStationId&&(!E.panelIsOpen&&!E.WaterLevelIsActive||E.panelIsOpen&&"WaterLevel"!==E.panelSelectedType)){const e=l.find((e=>e.id===E.selectedStationId));if(console.log("test"),e)return(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:i,zIndexOffset:1e3,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:s("waterLevelsStations.modal.stationName"),type:"WaterLevel"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,className:"bg-gray-800 text-white border-0 text-xs",children:(0,j.jsxs)("div",{className:"text-center",children:[(0,j.jsx)("div",{className:"font-semibold",children:e.name}),(0,j.jsx)("div",{className:"text-gray-300",children:e.category}),(0,j.jsx)("div",{className:"text-gray-300",children:d(e.lastTimestamp)})]})})},e.id)}return l.map((e=>(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:E.isSelected("WaterLevel",e.id)?i:o,zIndexOffset:E.isSelected("WaterLevel",e.id)?1e3:0,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:s("waterLevelsStations.modal.stationName"),type:"WaterLevel"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,permanent:!1,className:"custom-tooltip",children:(0,j.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px] max-w-[320px]",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[(0,j.jsx)(m.g,{icon:x.yzd,className:"text-blue-600 text-sm"}),(0,j.jsx)("h3",{className:"font-semibold text-gray-800 text-sm truncate",children:e.name})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("waterLevelsStations.tooltip.category")}),(0,j.jsx)("span",{className:"text-sm text-gray-700 bg-gray-100 px-2 py-1 rounded-md",children:e.category})]}),(0,j.jsxs)("div",{className:`flex justify-between items-center px-2 py-1 rounded-md ${ne(e.warningStatus)} `,children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("waterLevelsStations.tooltip.status")}),(0,j.jsx)("div",{className:"text-sm",children:ae(e.warningStatus)})]}),(0,j.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mt-3",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsx)("span",{className:"text-sm font-medium text-blue-600 uppercase ",children:s("waterLevelsStations.tooltip.waterLevel")}),(0,j.jsx)("span",{className:"text-sm font-bold text-blue-800",children:e.lastResult})]})}),(0,j.jsxs)("div",{className:"flex justify-between items-start pt-2 border-t border-gray-100  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:(0,j.jsx)(m.g,{icon:x.nwU,className:"text-2xl"})}),(0,j.jsx)("div",{className:"text-right text-xs text-gray-600",children:d(e.lastTimestamp)?d(e.lastTimestamp):"--"})]})]})]})})},e.id)))}),[l,o,s,i,E.effectiveWaterLevelIsActive]),h=(0,r.useMemo)((()=>e=>{const t=e.getChildCount()>0&&e.getAllChildMarkers().some((e=>e.options.stationId===E.selectedStationId&&"WaterLevel"===E.selectedStationType)),s=(()=>{if(e.getChildCount()<=1)return!1;const t=e.getBounds(),s=t.getEast()-t.getWest(),l=t.getNorth()-t.getSouth();return s>.01||l>.01})(),l=t?"bg-blue-500":"bg-blue-600",a=t?"border-4 border-yellow-400":"";return U().divIcon({html:`<div class="relative">\n            <div class="${l} ${a} text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg">${e.getChildCount()}</div>\n                                      ${t&&!s?'<span class="absolute inset-0 -m-1 rounded-full bg-blue-400/40 animate-ping"></span>':""}\n          </div>`,className:"custom-cluster-icon",iconSize:[40,40]})}),[]);return(0,j.jsx)(xe.A,{ref:a,iconCreateFunction:h,chunkedLoading:!0,maxClusterRadius:30,showCoverageOnHover:!1,spiderfyOnMaxZoom:!0,children:c})}))),ge=(0,i.PA)((()=>{const{t:e}=(0,y.Bd)();console.log("from FilterLayer");let t={WaterLevel:!0,Sewer:!1,Rain:!1,FloodNtc:!1};const s=sessionStorage.getItem("storedCityValue");sessionStorage.getItem("checkedLayersValue")&&(t=JSON.parse(sessionStorage.getItem("checkedLayersValue")));const[l,a]=(0,r.useState)(t),[n,o]=(0,r.useState)("base"),[i,d]=(0,r.useState)(!0),c=s||"";async function u(e,t){await E.getStationsByType(e,t)}const g=[{label:e("filterLayer.layers.waterLevel"),value:"WaterLevel"},{label:e("filterLayer.layers.sewer"),value:"Sewer"},{label:e("filterLayer.layers.rain"),value:"Rain"},{label:e("filterLayer.layers.floodNtc"),value:"FloodNtc"}],f=(0,r.useMemo)((()=>({WaterLevel:{toggle:()=>E.togglingWaterLevel(),isActive:()=>E.WaterLevelIsActive},Sewer:{toggle:()=>E.togglingSewer(),isActive:()=>E.SewerIsActive},Rain:{toggle:()=>E.togglingRain(),isActive:()=>E.RainIsActive},FloodNtc:{toggle:()=>E.togglingFloodNtc(),isActive:()=>E.FloodNtcIsActive}})),[]);return(0,r.useEffect)((()=>{sessionStorage.setItem("checkedLayersValue",JSON.stringify(l))}),[l]),(0,r.useEffect)((()=>{if(sessionStorage.getItem("checkedLayersValue")){const e=JSON.parse(sessionStorage.getItem("checkedLayersValue"));Object.entries(e).forEach((e=>{let[t,s]=e;const l=f[t];l&&(s?(u(t,c),l.isActive()||l.toggle()):l.isActive()&&l.toggle())}))}}),[c,f]),(0,j.jsxs)(h.Zp,{onWheel:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),className:"absolute  top-16 right-8 md:top-16 md:right-20 bg-gray-800 bg-opacity-70 text-white w-80 z-50 transition-[width] duration-300 ease-in-out",style:{width:i?"min(16rem, 5000px)":"56px",interpolateSize:"allow",zIndex:"400"},children:[(0,j.jsx)("div",{className:"absolute flex justify-center items-center text-white cursor-pointer max-w-[100px] "+(i?"opacity-0":"inset-0 nav opacity-1 "),onClick:()=>d(!0),children:(0,j.jsx)(m.g,{icon:x.Wzs})}),i&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(h.tU,{"aria-label":"Layer tabs",onActiveTabChange:e=>o(0===e?"base":"forecast"),theme:{tablist:{tabitem:{base:"flex items-center justify-center rounded-lg p-2 text-sm font-medium"}}},children:[(0,j.jsx)(h.tU.Item,{active:!0,title:e("filterLayer.tabs.base")}),(0,j.jsx)(h.tU.Item,{title:e("filterLayer.tabs.forecast")})]}),"base"===n&&(0,j.jsx)("div",{className:"text-sm",children:(0,j.jsx)("div",{className:"space-y-1 max-h-60 overflow-y-auto",children:g.map(((e,t)=>(0,j.jsxs)("div",{className:`flex items-center gap-2 ${l[e.value]&&"text-green-500"} `,children:[(0,j.jsx)(h.Sc,{className:"cursor-pointer",id:`layer-${t}`,checked:l[e.value],onChange:()=>(e=>{const t=!l[e];a((s=>({...s,[e]:t})));const s=f[e];s&&(s.toggle(),t&&u(e,c))})(e.value)}),(0,j.jsx)("label",{htmlFor:`layer-${t}`,className:"capitalize cursor-pointer",children:e.label})]},t)))})}),"forecast"===n&&(0,j.jsx)("div",{className:"mt-4 text-gray-400 text-sm",children:e("filterLayer.forecastEmpty")})]}),(0,j.jsx)("button",{onClick:()=>d((e=>!e)),onMouseDown:e=>e.stopPropagation(),className:`absolute top-4 ${i?"-left-[50px] translate-x-full":"opacity-0"} z-[1200] rounded-l-lg bg-gray-900/90 border border-white/20 text-white shadow p-2 hover:bg-gray-800`,"aria-label":e(i?"stationsSidePanel.labels.collapsePanel":"stationsSidePanel.labels.openPanel"),title:e(i?"stationsSidePanel.labels.collapse":"stationsSidePanel.labels.stationsTitle"),children:(0,j.jsx)(m.g,{icon:x.XkK})})]})})),fe=ge,pe=(0,i.PA)((0,r.forwardRef)(((e,t)=>{const{allRainLevelStations:s}=E,l=(0,r.useRef)(),{t:a}=(0,y.Bd)();(0,r.useImperativeHandle)(t,(()=>({declusterStation:e=>{if(l.current){const t=l.current,a=s.find((t=>t.id===e));if(a&&a.latitude&&a.longitude){if("Rain"===E.selectedStationType&&E.selectedStationId===e)return;const s=t.getLayers().find((t=>t.options&&t.options.stationId===e));s&&t.zoomToShowLayer(s,(()=>{}))}}}})));const n=(0,z.qV)((0,j.jsx)(m.g,{icon:x.S7o,className:"border border-red-700 text-black-800 bg-red-300 rounded-full p-2"})),o=U().divIcon({html:n,className:"fa-icon-marker",iconSize:[32,32],iconAnchor:[16,32]}),i=U().divIcon({html:(0,z.qV)((0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("span",{className:"absolute inset-0 -m-1 rounded-full bg-red-400/40 animate-ping"}),(0,j.jsx)(m.g,{icon:x.S7o,className:"relative border-2 border-white ring-8 ring-red-500 text-red-900 bg-red-300 rounded-full p-2 shadow-2xl"})]})),className:"fa-icon-marker-selected",iconSize:[48,48],iconAnchor:[24,48]});function d(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}const c=(0,r.useMemo)((()=>{if(!s)return"";if(console.log("[from Rain]",E.selectedStationType,E.selectedStationId,!E.effectiveRainIsActive),"Rain"===E.selectedStationType&&E.selectedStationId&&(!E.panelIsOpen&&!E.RainIsActive||E.panelIsOpen&&"Rain"!==E.panelSelectedType)){const e=s.find((e=>e.id===E.selectedStationId));if(e)return(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:i,zIndexOffset:1e3,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:a("rainStations.modal.stationName"),type:"Rain"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,className:"bg-gray-800 text-white border-0 text-xs",children:(0,j.jsxs)("div",{className:"text-center",children:[(0,j.jsx)("div",{className:"font-semibold",children:e.name}),(0,j.jsx)("div",{className:"text-gray-300",children:e.category}),(0,j.jsx)("div",{className:"text-gray-300",children:d(e.lastTimestamp)})]})})},e.id)}return s.map((e=>(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:E.isSelected("Rain",e.id)?i:o,zIndexOffset:E.isSelected("Rain",e.id)?1e3:0,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:a("rainStations.modal.stationName"),type:"Rain"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,permanent:!1,className:"custom-tooltip",children:(0,j.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px] max-w-[320px]",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[(0,j.jsx)(m.g,{icon:x.yzd,className:"text-blue-600 text-sm"}),(0,j.jsx)("h3",{className:"font-semibold text-gray-800 text-sm truncate",children:e.name})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:a("rainStations.tooltip.category")}),(0,j.jsx)("span",{className:"text-sm text-gray-700 bg-gray-100 px-2 py-1 rounded-md",children:e.category})]}),(0,j.jsxs)("div",{className:`flex justify-between items-center px-2 py-1 rounded-md ${ne(e.warningStatus)} `,children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:a("rainStations.tooltip.status")}),(0,j.jsx)("div",{className:"text-sm",children:ae(e.warningStatus)})]}),(0,j.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mt-3",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:a("rainStations.tooltip.waterLevel")}),(0,j.jsx)("span",{className:"text-sm font-bold text-blue-800",children:e.lastResult})]})}),(0,j.jsxs)("div",{className:"flex justify-between items-start pt-2 border-t border-gray-100  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:(0,j.jsx)(m.g,{icon:x.nwU,className:"text-2xl"})}),(0,j.jsx)("div",{className:"text-right text-xs text-gray-600",children:d(e.lastTimestamp)?d(e.lastTimestamp):"--"})]})]})]})})},e.id)))}),[s,o,i,a]),h=(0,r.useMemo)((()=>e=>{const t=e.getChildCount()>0&&e.getAllChildMarkers().some((e=>e.options.stationId===E.selectedStationId&&"Rain"===E.selectedStationType)),s=(()=>{if(e.getChildCount()<=1)return!1;const t=e.getBounds(),s=t.getEast()-t.getWest(),l=t.getNorth()-t.getSouth();return s>.01||l>.01})(),l=t?"bg-red-500":"bg-red-600",a=t?"border-4 border-yellow-400":"";return U().divIcon({html:`<div class="relative">\n            <div class="${l} ${a} text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg">${e.getChildCount()}</div>\n                                      ${t&&!s?'<span class="absolute inset-0 -m-1 rounded-full bg-red-400/40 animate-ping"></span>':""}\n          </div>`,className:"custom-cluster-icon",iconSize:[40,40]})}),[]);return(0,j.jsx)(xe.A,{ref:l,iconCreateFunction:h,chunkedLoading:!0,maxClusterRadius:30,showCoverageOnHover:!1,spiderfyOnClick:!0,children:c})}))),be=(0,i.PA)((0,r.forwardRef)(((e,t)=>{const{allSewerLevelStations:s}=E,l=(0,r.useRef)(),{t:a}=(0,y.Bd)();(0,r.useImperativeHandle)(t,(()=>({declusterStation:e=>{if(l.current){const t=l.current,a=s.find((t=>t.id===e));if(a&&a.latitude&&a.longitude){if("Sewer"===E.selectedStationType&&E.selectedStationId===e)return;const s=t.getLayers().find((t=>t.options&&t.options.stationId===e));s&&t.zoomToShowLayer(s,(()=>{}))}}}})));const n=(0,z.qV)((0,j.jsx)(m.g,{icon:x.ibi,className:"border border-green-700 text-black-800 bg-green-300 rounded-full p-2"})),o=U().divIcon({html:n,className:"fa-icon-marker",iconSize:[32,32],iconAnchor:[16,32]}),i=U().divIcon({html:(0,z.qV)((0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("span",{className:"absolute inset-0 -m-1 rounded-full bg-green-400/40 animate-ping"}),(0,j.jsx)(m.g,{icon:x.ibi,className:"relative border-2 border-white ring-8 ring-green-500 text-green-900 bg-green-300 rounded-full p-2 shadow-2xl"})]})),className:"fa-icon-marker-selected",iconSize:[48,48],iconAnchor:[24,48]});function d(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}const c=(0,r.useMemo)((()=>{if(!s)return"";if(console.log("[from Sewar]",E.selectedStationType,E.selectedStationId,!E.effectiveSewerIsActive),"Sewer"===E.selectedStationType&&E.selectedStationId&&(!E.panelIsOpen&&!E.SewerIsActive||E.panelIsOpen&&"Sewer"!==E.panelSelectedType)){const e=s.find((e=>e.id===E.selectedStationId));if(e)return(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:i,zIndexOffset:1e3,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:a("SewerStations.modal.stationName"),type:"Sewer"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,className:"bg-gray-800 text-white border-0 text-xs",children:(0,j.jsxs)("div",{className:"text-center",children:[(0,j.jsx)("div",{className:"font-semibold",children:e.name}),(0,j.jsx)("div",{className:"text-gray-300",children:e.category}),(0,j.jsx)("div",{className:"text-gray-300",children:d(e.lastTimestamp)})]})})},e.id)}return s.map((e=>(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:E.isSelected("Sewer",e.id)?i:o,zIndexOffset:E.isSelected("Sewer",e.id)?1e3:0,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:a("SewerStations.modal.stationName"),type:"Sewer"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,permanent:!1,className:"custom-tooltip",children:(0,j.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px] max-w-[320px]",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[(0,j.jsx)(m.g,{icon:x.yzd,className:"text-blue-600 text-sm"}),(0,j.jsx)("h3",{className:"font-semibold text-gray-800 text-sm truncate",children:e.name})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:a("SewerStations.tooltip.category")}),(0,j.jsx)("span",{className:"text-sm text-gray-700 bg-gray-100 px-2 py-1 rounded-md",children:e.category})]}),(0,j.jsxs)("div",{className:`flex justify-between items-center px-2 py-1 rounded-md ${ne(e.warningStatus)} `,children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:a("SewerStations.tooltip.status")}),(0,j.jsx)("div",{className:"text-sm",children:ae(e.warningStatus)})]}),(0,j.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mt-3",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:a("SewerStations.tooltip.waterLevel")}),(0,j.jsx)("span",{className:"text-sm font-bold text-blue-800",children:e.lastResult})]})}),(0,j.jsxs)("div",{className:"flex justify-between items-start pt-2 border-t border-gray-100  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:(0,j.jsx)(m.g,{icon:x.nwU,className:"text-2xl"})}),(0,j.jsx)("div",{className:"text-right text-xs text-gray-600",children:d(e.lastTimestamp)?d(e.lastTimestamp):"--"})]})]})]})})},e.id)))}),[s,o,i,a]),h=(0,r.useMemo)((()=>e=>{const t=e.getChildCount()>0&&e.getAllChildMarkers().some((e=>e.options.stationId===E.selectedStationId&&"Sewer"===E.selectedStationType)),s=(()=>{if(e.getChildCount()<=1)return!1;const t=e.getBounds(),s=t.getEast()-t.getWest(),l=t.getNorth()-t.getSouth();return s>.01||l>.01})(),l=t?"bg-green-500":"bg-green-600",a=t?"border-4 border-yellow-400":"";return U().divIcon({html:`<div class="relative">\n            <div class="${l} ${a} text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg">${e.getChildCount()}</div>\n                                      ${t&&!s?'<span class="absolute inset-0 -m-1 rounded-full bg-green-400/40 animate-ping"></span>':""}\n          </div>`,className:"custom-cluster-icon",iconSize:[40,40]})}),[]);return(0,j.jsx)(xe.A,{ref:l,iconCreateFunction:h,chunkedLoading:!0,maxClusterRadius:30,showCoverageOnHover:!1,spiderfyOnClick:!0,children:c})}))),ve={WaterLevel:e=>({columns:[{key:"name",header:e("table.name"),width:"w-32",cellClass:"font-medium whitespace-nowrap px-3",render:e=>e||"-"},{key:"category",header:e("table.category"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>e||"-"},{key:"city",header:e("table.city"),width:"w-24",cellClass:"w-24 text-center px-2",render:(e,t)=>t.city||t.county||"-"},{key:"lastResult",header:e("table.lastResult"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>null!==e&&void 0!==e?e:"-"},{key:"lastTimestamp",header:e("table.lastTime"),width:"w-32",cellClass:"w-32 whitespace-nowrap px-2",render:(e,t,s)=>{var l,a;if(!e)return"-";const n=s(e);return(0,j.jsxs)(j.Fragment,{children:[null!==(l=n.slice(0,11))&&void 0!==l?l:"-",(0,j.jsx)("br",{}),null!==(a=null===n||void 0===n?void 0:n.slice(11,21))&&void 0!==a?a:"-"]})}},{key:"alertL1",header:e("table.warnLv1"),width:"w-20",cellClass:"w-20 text-center px-2",render:e=>null!==e&&void 0!==e?e:"-"},{key:"alertL2",header:e("table.warnLv2"),width:"w-20",cellClass:"w-20 text-center px-2",render:e=>null!==e&&void 0!==e?e:"-"},{key:"alertL3",header:e("table.warnLv3"),width:"w-20",cellClass:"w-20 text-center px-2",render:e=>null!==e&&void 0!==e?e:"-"},{key:"warningStatus",header:e("table.status"),width:"w-40",cellClass:"w-40 px-2",render:(e,t,s,l,a)=>(0,j.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${a(e)}`,children:l(e)})}]}),Rain:e=>({columns:[{key:"name",header:e("table.name"),width:"w-32",cellClass:"font-medium whitespace-nowrap px-3",render:e=>e||"-"},{key:"category",header:e("table.category"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>e||"-"},{key:"county",header:e("table.county"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>e||"-"},{key:"area",header:e("table.area"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>e||"-"},{key:"lastResult",header:e("table.lastResult"),width:"w-24",cellClass:"w-24 text-center px-2",render:e=>`${e} mm`},{key:"lastTimestamp",header:e("table.lastTime"),width:"w-32",cellClass:"w-32 whitespace-nowrap px-2",render:(e,t,s)=>{var l,a;const n=s(e);return(0,j.jsxs)(j.Fragment,{children:[null!==(l=n.slice(0,11))&&void 0!==l?l:"-",(0,j.jsx)("br",{}),null!==(a=null===n||void 0===n?void 0:n.slice(11,21))&&void 0!==a?a:"-"]})}},{key:"alertL2",header:e("table.alertH1"),width:"w-20",cellClass:"w-20 text-center px-2",render:e=>e},{key:"alertL1",header:e("table.floodH1"),width:"w-20",cellClass:"w-20 text-center px-2",render:e=>e},{key:"warningStatus",header:e("table.status"),width:"w-40",cellClass:"w-40 px-2",render:(e,t,s,l,a)=>(0,j.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${a(e)}`,children:l(e)})}]})};function ye(e){let{filteredItems:t,openDetails:s,selectedType:a,handleTogglePanel:n,declusterStation:o}=e;const{t:i}=(0,y.Bd)(),r=(0,l.ko)(),d=((e,t)=>(ve[e]||ve.WaterLevel)(t))(a,i),c=(e=>{const t=e.reduce(((e,t)=>{const s=t.width;return"w-20"===s?e+80:"w-24"===s?e+96:"w-32"===s?e+128:"w-40"===s?e+160:e+100}),0);return t<=800?"min-w-[800px]":t<=900?"min-w-[900px]":t<=1e3?"min-w-[1000px]":"min-w-[1100px]"})(d.columns),u=e=>{switch(e){case"AboveLevel_1":case"lvl_above_1":case"level_above_1":case"above_level_1":case"Danger":return"even:bg-gray-300 odd:bg-gray-300";case"AboveLevel_2":case"lvl_above_2":case"level_above_2":case"above_level_2":return"even:bg-gray-200 odd:bg-gray-200";case"AboveLevel_3":case"lvl_above_3":case"level_above_3":case"above_level_3":return"even:bg-gray-100 odd:bg-gray-100";default:return"even:bg-white odd:bg-white"}};function g(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}return(0,j.jsxs)(h.XI,{striped:!0,theme:{root:{base:`w-full ${c} text-left text-[0.95rem] text-gray-200`}},children:[(0,j.jsxs)(h.XI.Head,{className:"text-xs",children:[d.columns.map(((e,t)=>(0,j.jsx)(h.XI.HeadCell,{className:`bg-gray-800/90 backdrop-blur sticky top-0 z-10 text-gray-100 ${e.width} ${t===d.columns.length-1?"text-right":""}`,children:e.header},e.key))),(0,j.jsx)(h.XI.HeadCell,{className:"bg-gray-800/90 backdrop-blur sticky top-0 z-10 text-gray-100 text-right w-20",children:i("table.details")})]}),(0,j.jsxs)(h.XI.Body,{className:"divide-y divide-white/10 text-xs",children:[t.map((e=>(0,j.jsxs)(h.XI.Row,{className:`${u(e.warningStatus)} cursor-pointer text-black`,onClick:()=>{E.clearSelectedStation(),n(),E.setSelectedStation(a,e.id),e.latitude&&e.longitude&&(r.flyTo([e.latitude,e.longitude],15,{duration:.8}),o&&o(a,e.id))},children:[d.columns.map((t=>(0,j.jsx)(h.XI.Cell,{className:t.cellClass,children:t.render(e[t.key],e,g,ae,ne)},t.key))),(0,j.jsx)(h.XI.Cell,{className:"text-right w-20 px-2",children:(0,j.jsx)(h.$n,{size:"xs",color:"light",onClick:t=>{t.stopPropagation(),s(e.id,g(e.lastTimestamp))},children:(0,j.jsxs)("span",{className:"flex items-center gap-1",children:[(0,j.jsx)(m.g,{icon:x.mEO,className:"me-1"}),i("table.info")]})})})]},e.id))),0===t.length&&(0,j.jsx)(h.XI.Row,{children:(0,j.jsx)(h.XI.Cell,{colSpan:d.columns.length+1,className:"text-center text-gray-400",children:i("stationsDataTable.messages.noStations")})})]})]})}const je=(0,i.PA)((e=>{let{declusterStation:t}=e;const{t:s}=(0,y.Bd)(),[l,a]=(0,r.useState)((()=>E.WaterLevelIsActive?"WaterLevel":E.RainIsActive?"Rain":E.SewerIsActive?"Sewer":E.FloodNtcIsActive?"FloodNtc":"WaterLevel")),[n,o]=(0,r.useState)(""),[i,d]=(0,r.useState)(null),[c,g]=(0,r.useState)(""),[f,p]=(0,r.useState)(!0),b={WaterLevel:s("stationsSidePanel.types.WaterLevel"),Rain:s("stationsSidePanel.types.Rain"),Sewer:s("stationsSidePanel.types.Sewer"),FloodNtc:s("stationsSidePanel.types.FloodNTC")};(0,r.useEffect)((()=>{const e=E.stationsByType[l],t=sessionStorage.getItem("storedCityValue")||"",s=E.isLoadingByType[l];console.log(`[StationsSidePanel] Checking data for ${l}:`,{data:e,isLoading:s,hasData:!!e,dataLength:null===e||void 0===e?void 0:e.length,storeError:E.error}),e||s?e?console.log(`Data already exists for ${l}, skipping fetch`):s&&console.log(`Data is already being loaded for ${l}`):(console.log(`Loading data for ${l} with city: ${t}`),E.getStationsByType(l,t).then((()=>{console.log(`[StationsSidePanel] Data loading completed for ${l}`),console.log("[StationsSidePanel] New data:",E.stationsByType[l])})).catch((e=>{console.error(`[StationsSidePanel] Error loading data for ${l}:`,e)})))}),[l]),(0,r.useEffect)((()=>{E.setPanelOpen(f)}),[f]),(0,r.useEffect)((()=>{f&&E.setPanelSelectedType(l)}),[f,l]),(0,r.useEffect)((()=>{!async function(){try{var e;const t=await E.getAllCities();d((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.result)||[])}catch(t){d([])}}()}),[]);const v=E.isLoadingByType[l],w=E.stationsByType[l],N=(0,r.useMemo)((()=>{const e={AboveLevel_1:0,AboveLevel_2:1,AboveLevel_3:2,normal:3,Danger:0,Warning:1,Normal:3,unknown:4,lvl_above_1:0,lvl_above_2:1,lvl_above_3:2,level_above_1:0,level_above_2:1,level_above_3:2,above_level_1:0,above_level_2:1,above_level_3:2},t=E.stationsByType[l],s=E.isLoadingByType[l];if(console.log(`[StationsSidePanel] selectedType: ${l}, items:`,t,"isLoading:",s,"store data keys:",Object.keys(E.stationsByType)),s)return console.log(`[StationsSidePanel] Still loading data for ${l}`),[];if(!t)return console.log(`[StationsSidePanel] No data available for ${l} after loading`),[];console.log("[StationsSidePanel] Items type:",typeof t,"isArray:",Array.isArray(t),"length:",null===t||void 0===t?void 0:t.length);let a=t;if(t&&"object"===typeof t&&void 0!==t.length)try{a=Array.from(t),console.log(`[StationsSidePanel] Converted MobX Proxy to array, length: ${a.length}`),console.log("[StationsSidePanel] First few items:",a.slice(0,3))}catch(r){console.error("[StationsSidePanel] Error converting MobX Proxy:",r),a=[]}if(!a||!Array.isArray(a))return console.log(`[StationsSidePanel] No valid data for ${l}, returning empty array`),[];if(!n)return console.log(`[StationsSidePanel] Returning ${a.length} items without search filter`),a;const o=n.toLowerCase(),i=a.filter((e=>[e.name,e.category,e.city,e.county,e.area].filter(Boolean).some((e=>String(e).toLowerCase().includes(o))))).sort(((t,s)=>{var l,a;return(null!==(l=e[t.warningStatus])&&void 0!==l?l:999)-(null!==(a=e[s.warningStatus])&&void 0!==a?a:999)}));return console.log(`[StationsSidePanel] Filtered ${a.length} items to ${i.length} with search: "${n}"`),i}),[l,n,w]),S=e=>{let{value:t}=e;return(0,j.jsx)("button",{className:"px-4 py-1.5 rounded-full text-sm font-semibold tracking-wide transition-colors shadow "+(l===t?"bg-sky-500 text-white shadow-sky-800/30":"bg-gray-700/60 text-gray-200 hover:bg-gray-600/70"),onClick:()=>{a(t),f&&E.setPanelSelectedType(t)},children:b[t]})},k=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(k.current)try{U().DomEvent.disableScrollPropagation(k.current),U().DomEvent.disableClickPropagation(k.current)}catch(e){}}),[]),(0,j.jsxs)("div",{ref:k,onWheel:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),className:"absolute  top-4 left-8 md:top-16 md:left-20 max-h-[85vh] transition-[width] duration-300 ease-in-out",style:{width:f?"min(85vw, 1000px)":"56px",interpolateSize:"allow",zIndex:"400"},children:[(0,j.jsx)("div",{className:"absolute flex justify-center items-center text-white cursor-pointer max-w-[100px] "+(f?"opacity-0":"inset-0 nav opacity-1 "),onClick:()=>p(!0),children:(0,j.jsx)(m.g,{icon:x.XkK})}),(0,j.jsxs)(h.Zp,{className:"overflow-hidden bg-gray-900/65 backdrop-blur-md border border-white/10 shadow-2xl",children:[(0,j.jsx)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:(0,j.jsxs)("div",{className:f?"flex items-center justify-between flex-1 gap-2":"hidden",children:[(0,j.jsx)("div",{className:f?"flex gap-2 flex-wrap items-center":"flex items-center justify-end w-full",children:f&&["WaterLevel","Rain","Sewer","FloodNtc"].map((e=>(0,j.jsx)(S,{value:e},e)))}),(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)("span",{className:"text-white/90 font-semibold text-base md:text-lg",children:s("stationsSidePanel.labels.stations")}),(0,j.jsx)(h.Ex,{color:"info",className:"bg-sky-600/80 text-white",children:N.length})]})]})}),f&&E.stationsMetaByType[l]&&(0,j.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs text-white/90",children:((e,t,a,n,o,i,r,d,c)=>{const u=E.stationsMetaByType[l],m=u.warningStatusCounts||{},x=u.operationStatusCounts||{};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-green-600/70",children:[s("stationsSidePanel.status.normal"),":"," ",null!==(e=m.normal+m.aboveLevel_3)&&void 0!==e?e:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-yellow-600/70",children:[s("stationsSidePanel.status.warning"),":"," ",null!==(t=m.aboveLevel_2)&&void 0!==t?t:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-orange-600/70",children:[s("stationsSidePanel.status.lv2"),":"," ",null!==(a=m.aboveLevel_1+m.danger)&&void 0!==a?a:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-red-600/80",children:[s("stationsSidePanel.status.lv3"),":"," ",null!==(n=m.aboveLevel_4)&&void 0!==n?n:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-gray-500/70",children:[s("stationsSidePanel.status.unknown"),":"," ",null!==(o=m.unknown)&&void 0!==o?o:0]})]}),(0,j.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-end",children:[(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-sky-600/70",children:[s("stationsSidePanel.status.active"),": ",null!==(i=x.active)&&void 0!==i?i:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-gray-600/70",children:[s("stationsSidePanel.status.inactive"),":"," ",null!==(r=x.inactive)&&void 0!==r?r:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-purple-600/70",children:[s("stationsSidePanel.status.maintenance"),":"," ",null!==(d=x.maintenance)&&void 0!==d?d:0]}),(0,j.jsxs)("span",{className:"px-2 py-1 rounded bg-red-500/70",children:[s("stationsSidePanel.status.outOfService"),":"," ",null!==(c=x.outOfService)&&void 0!==c?c:0]})]})]})})()}),f&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"mt-3 grid grid-cols-5 gap-2 transition-all",children:[(0,j.jsx)("div",{className:"col-span-3",children:(0,j.jsx)(h.ks,{value:n,onChange:e=>o(e.target.value),placeholder:s("stationsSidePanel.labels.searchPlaceholder",{type:b[l]}),className:"bg-gray-800/80 text-white placeholder-gray-400"})}),(0,j.jsx)("div",{className:"col-span-2",children:(0,j.jsxs)(h.l6,{value:c,onChange:e=>(async e=>{e!==c?(g(e),sessionStorage.setItem("storedCityValue",e),console.log(`City changed to ${e}, refetching data for ${l}`),await E.getStationsByType(l,e)):console.log(`City unchanged (${e}), skipping refetch`)})(e.target.value),className:"bg-gray-800/80 text-white",children:[(0,j.jsx)("option",{value:"",children:s("stationsSidePanel.labels.allRegions")}),null===i||void 0===i?void 0:i.map(((e,t)=>(0,j.jsx)("option",{value:e,children:e},t)))]})})]}),(0,j.jsx)("div",{className:"mt-3 rounded-lg overflow-hidden border border-white/10",children:v?(0,j.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,j.jsx)(h.y$,{color:"info"})}):(0,j.jsx)("div",{className:"md:max-h-[60vh] max-h-[45vh] overflow-auto",children:(0,j.jsx)(ye,{filteredItems:N,openDetails:(e,t)=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e,stationName:b[l],type:l}))},selectedType:l,handleTogglePanel:()=>p((e=>!e)),declusterStation:t})})})]})]}),(0,j.jsx)("button",{onClick:()=>p((e=>!e)),onMouseDown:e=>e.stopPropagation(),className:`absolute top-4 ${f?"-right-0 translate-x-full":"opacity-0"} z-[1200] rounded-r-lg bg-gray-900/90 border border-white/20 text-white shadow p-2 hover:bg-gray-800`,"aria-label":s(f?"stationsSidePanel.labels.collapsePanel":"stationsSidePanel.labels.openPanel"),title:s(f?"stationsSidePanel.labels.collapse":"stationsSidePanel.labels.stationsTitle"),children:(0,j.jsx)(m.g,{icon:x.Wzs})})]})})),we=(0,i.PA)((0,r.forwardRef)(((e,t)=>{const{t:s}=(0,y.Bd)(),{allFloodNtcStations:l}=E,a=(0,r.useRef)();(0,r.useImperativeHandle)(t,(()=>({declusterStation:e=>{if(a.current){const t=a.current,s=l.find((t=>t.id===e));if(s&&s.latitude&&s.longitude){if("FloodNtc"===E.selectedStationType&&E.selectedStationId===e)return;const s=t.getLayers().find((t=>t.options&&t.options.stationId===e));s&&t.zoomToShowLayer(s,(()=>{}))}}}})));const n=(0,z.qV)((0,j.jsx)(m.g,{icon:x.NT7,className:"border border-yellow-700 text-yellow-800 bg-yellow-300 rounded-full p-2"})),o=U().divIcon({html:n,className:"fa-icon-marker",iconSize:[32,32],iconAnchor:[16,32]}),i=U().divIcon({html:(0,z.qV)((0,j.jsxs)("div",{className:"relative",children:[(0,j.jsx)("span",{className:"absolute inset-0 -m-1 rounded-full bg-yellow-400/40 animate-ping"}),(0,j.jsx)(m.g,{icon:x.NT7,className:"relative border-2 border-white ring-8 ring-yellow-500 text-yellow-900 bg-yellow-300 rounded-full p-2 shadow-2xl"})]})),className:"fa-icon-marker-selected",iconSize:[48,48],iconAnchor:[24,48]});function d(e){const t=new Date(e);return"Invalid Date"===t.toString()?"":t.toLocaleString()}const c=(0,r.useMemo)((()=>{if(!l)return"";if(console.log("[from flood]",E.selectedStationType,E.selectedStationId,!E.effectiveFloodNtcIsActive),"FloodNtc"===E.selectedStationType&&E.selectedStationId&&(!E.panelIsOpen&&!E.FloodNtcIsActive||E.panelIsOpen&&"FloodNtc"!==E.panelSelectedType)){const e=l.find((e=>e.id===E.selectedStationId));if(e)return(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:i,zIndexOffset:1e3,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:s("floodNtcStations.modal.stationName"),type:"FloodNtc"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,className:"bg-gray-800 text-white border-0 text-xs",children:(0,j.jsxs)("div",{className:"text-center",children:[(0,j.jsx)("div",{className:"font-semibold",children:e.name}),(0,j.jsx)("div",{className:"text-gray-300",children:e.category}),(0,j.jsx)("div",{className:"text-gray-300",children:d(e.lastTimestamp)})]})})},e.id)}return l.map((e=>(0,j.jsx)(V.p,{position:[e.latitude,e.longitude],icon:E.isSelected("FloodNtc",e.id)?i:o,zIndexOffset:E.isSelected("FloodNtc",e.id)?1e3:0,stationId:e.id,eventHandlers:{click:()=>{u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:e.id,stationName:s("floodNtcStations.modal.stationName"),type:"FloodNtc"}))}},children:(0,j.jsx)(q.m,{direction:"top",offset:[0,-15],opacity:1,permanent:!1,className:"custom-tooltip",children:(0,j.jsxs)("div",{className:"bg-white rounded-lg shadow-xl border border-gray-200 p-4 min-w-[280px] max-w-[320px]",children:[(0,j.jsxs)("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[(0,j.jsx)(m.g,{icon:x.yzd,className:"text-blue-600 text-sm"}),(0,j.jsx)("h3",{className:"font-semibold text-gray-800 text-sm truncate",children:e.name})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("floodNtcStations.tooltip.category")}),(0,j.jsx)("span",{className:"text-sm text-gray-700 bg-gray-100 px-2 py-1 rounded-md",children:e.category})]}),(0,j.jsxs)("div",{className:`flex justify-between items-center px-2 py-1 rounded-md ${ne(e.warningStatus)} `,children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("floodNtcStations.tooltip.status")}),(0,j.jsx)("div",{className:"text-sm",children:ae(e.warningStatus)})]}),(0,j.jsx)("div",{className:"bg-blue-50 rounded-lg p-3 mt-3",children:(0,j.jsxs)("div",{className:"flex justify-between items-center",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-blue-600 uppercase tracking-wide",children:s("floodNtcStations.tooltip.waterLevel")}),(0,j.jsx)("span",{className:"text-sm font-bold text-blue-800",children:e.lastResult})]})}),(0,j.jsxs)("div",{className:"flex justify-between items-start pt-2 border-t border-gray-100  bg-gray-100 px-2 py-1 rounded-md",children:[(0,j.jsx)("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:(0,j.jsx)(m.g,{icon:x.nwU,className:"text-2xl"})}),(0,j.jsx)("div",{className:"text-right text-xs text-gray-600",children:d(e.lastTimestamp)?d(e.lastTimestamp):"--"})]})]})]})})},e.id)))}),[l,o,i,s]),h=(0,r.useMemo)((()=>e=>{const t=e.getChildCount()>0&&e.getAllChildMarkers().some((e=>e.options.stationId===E.selectedStationId&&"FloodNtc"===E.selectedStationType)),s=(()=>{if(e.getChildCount()<=1)return!1;const t=e.getBounds(),s=t.getEast()-t.getWest(),l=t.getNorth()-t.getSouth();return s>.01||l>.01})(),l=t?"bg-yellow-500":"bg-yellow-600",a=t?"border-4 border-yellow-400":"";return U().divIcon({html:`<div class="relative">\n            <div class="${l} ${a} text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg">${e.getChildCount()}</div>\n                                      ${t&&!s?'<span class="absolute inset-0 -m-1 rounded-full bg-yellow-400/40 animate-ping"></span>':""}\n          </div>`,className:"custom-cluster-icon",iconSize:[40,40]})}),[]);return(0,j.jsx)(xe.A,{ref:a,iconCreateFunction:h,chunkedLoading:!0,maxClusterRadius:30,showCoverageOnHover:!1,spiderfyOnClick:!0,children:c})}))),Ne=(0,i.PA)((()=>{const{t:e}=(0,y.Bd)(),[t,s]=(0,r.useState)([]);return(0,r.useEffect)((()=>{!async function(){try{const e=await E.fetchCountiesWithAreasAndStations("Rain");s(e.data.result),console.log(e.data.result)}catch(e){console.log(e)}}()}),[]),(0,j.jsx)("div",{className:"block nav relative left-4 top-20 md:left-10 md:top-10 bg-slate-400 text-black font-bold text-xl rounded w-fit",children:(0,j.jsx)(h.ms,{renderTrigger:()=>(0,j.jsx)("button",{className:"p-2",children:(0,j.jsx)(m.g,{icon:x.ckx})}),children:t?(0,j.jsx)("div",{className:"max-h-[78vh] nav overflow-y-auto w-full",onWheel:e=>e.stopPropagation(),onWheelCapture:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),onScroll:e=>e.stopPropagation(),children:t.map(((t,s)=>(0,j.jsx)(h.ms,{style:{background:"white",color:"black"},label:t.countyName,placement:"right",children:(0,j.jsx)("div",{className:"max-h-[90vh] nav overflow-y-auto w-full",onWheel:e=>e.stopPropagation(),onWheelCapture:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),onScroll:e=>e.stopPropagation(),children:t.countyAreas.map(((t,s)=>(0,j.jsx)(h.ms,{style:{background:"white",color:"black"},label:t.areaName,placement:"right",children:(0,j.jsx)("div",{className:"max-h-[90vh] nav overflow-y-auto w-full",onWheel:e=>e.stopPropagation(),onWheelCapture:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),onScroll:e=>e.stopPropagation(),children:t.areaStations.map(((t,s)=>(0,j.jsx)(h.tJ,{onClick:()=>{!function(t){u.open((0,j.jsx)(me,{close:()=>u.close(),elementId:t.stationId,stationName:e("rainStations.modal.stationName"),type:"Rain"}))}(t)},children:t.stationName},s)))})},s)))})},s)))}):(0,j.jsx)(h.tJ,{disabled:!0,children:e("buttonBar.loading")})})})})),Se=(0,i.PA)((()=>{function e(){const e=(0,l.ko)();return(0,r.useEffect)((()=>{e.zoomControl.remove()}),[e]),null}console.log("render-home");const t=(0,r.useRef)(),s=(0,r.useRef)(),i=(0,r.useRef)(),c=(0,r.useRef)();return(0,r.useEffect)((()=>{!async function(){try{const e=await d.A.GetComprehensiveApplicationInfo();console.log("userInfo",e.data.result.user.permissions),d.A.userPermissions=e.data.result.user.permissions}catch(e){}}()}),[]),(0,j.jsxs)("div",{className:"home-page",children:[(0,j.jsxs)(a.W,{attributionControl:!1,center:[25.03418922,121.4506683],zoom:11,style:{height:"100vh",cursor:"default"},children:[(0,j.jsx)(B,{}),(0,j.jsx)(fe,{}),(0,j.jsx)(Ne,{}),(0,j.jsx)(je,{declusterStation:(e,l)=>{switch(e){case"WaterLevel":t.current&&t.current.declusterStation(l);break;case"Rain":s.current&&s.current.declusterStation(l);break;case"Sewer":i.current&&i.current.declusterStation(l);break;case"FloodNtc":c.current&&c.current.declusterStation(l)}}}),(0,j.jsx)(n.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,j.jsx)(e,{}),(0,j.jsx)(o.p,{position:"bottomleft"}),E.effectiveWaterLevelIsActive&&d.A.userPermissions&&(0,j.jsx)(he,{ref:t}),E.effectiveRainIsActive&&d.A.userPermissions&&(0,j.jsx)(pe,{ref:s}),E.effectiveSewerIsActive&&d.A.userPermissions&&(0,j.jsx)(be,{ref:i}),E.effectiveFloodNtcIsActive&&d.A.userPermissions&&(0,j.jsx)(we,{ref:c})]}),(0,j.jsx)(W,{})]})}))}}]);
//# sourceMappingURL=127.ea1954a4.chunk.js.map